
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>rotorse.rotor_structure &#8212; RotorSE 0.1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/nrel.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">RotorSE 0.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for rotorse.rotor_structure</h1><div class="highlight"><pre>
<span></span><span class="c1">#from __future__ import print_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">openmdao.api</span> <span class="k">import</span> <span class="n">IndepVarComp</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Group</span><span class="p">,</span> <span class="n">Problem</span>
<span class="kn">from</span> <span class="nn">ccblade.ccblade_component</span> <span class="k">import</span> <span class="n">CCBladePower</span><span class="p">,</span> <span class="n">CCBladeLoads</span><span class="p">,</span> <span class="n">CCBladeGeometry</span>
<span class="kn">from</span> <span class="nn">commonse</span> <span class="k">import</span> <span class="n">gravity</span><span class="p">,</span> <span class="n">NFREQ</span>
<span class="kn">from</span> <span class="nn">commonse.csystem</span> <span class="k">import</span> <span class="n">DirectionVector</span>
<span class="kn">from</span> <span class="nn">commonse.utilities</span> <span class="k">import</span> <span class="n">trapz_deriv</span><span class="p">,</span> <span class="n">interp_with_deriv</span>
<span class="kn">from</span> <span class="nn">precomp</span> <span class="k">import</span> <span class="n">_precomp</span>
<span class="kn">from</span> <span class="nn">akima</span> <span class="k">import</span> <span class="n">Akima</span><span class="p">,</span> <span class="n">akima_interp_with_derivs</span>
<span class="kn">from</span> <span class="nn">rotor_geometry</span> <span class="k">import</span> <span class="n">RotorGeometry</span><span class="p">,</span> <span class="n">NREL5MW</span><span class="p">,</span> <span class="n">DTU10MW</span><span class="p">,</span> <span class="n">NINPUT</span><span class="p">,</span> <span class="n">TURBULENCE_CLASS</span>
<span class="kn">import</span> <span class="nn">_pBEAM</span>
<span class="kn">import</span> <span class="nn">_curvefem</span>
<span class="c1"># import ccblade._bem as _bem  # TODO: move to rotoraero</span>
<span class="kn">import</span> <span class="nn">_bem</span>  <span class="c1"># TODO: move to rotoraero</span>

<span class="kn">from</span> <span class="nn">rotorse</span> <span class="k">import</span> <span class="n">RPM2RS</span><span class="p">,</span> <span class="n">RS2RPM</span>


<span class="c1"># ---------------------</span>
<span class="c1"># Base Components</span>
<span class="c1"># ---------------------</span>

<div class="viewcode-block" id="BeamPropertiesBase"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.BeamPropertiesBase">[docs]</a><span class="k">class</span> <span class="nc">BeamPropertiesBase</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BeamPropertiesBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;beam:z&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;locations of properties along beam&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;beam:EA&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial stiffness&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;beam:EIxx&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;edgewise stiffness (bending about :ref:`x-direction of airfoil aligned coordinate system &lt;blade_airfoil_coord&gt;`)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;beam:EIyy&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;flatwise stiffness (bending about y-direction of airfoil aligned coordinate system)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;beam:EIxy&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;coupled flap-edge stiffness&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;beam:GJ&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;torsional stiffness (about axial z-direction of airfoil aligned coordinate system)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;beam:rhoA&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass per unit length&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;beam:rhoJ&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;polar mass moment of inertia per unit length&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;beam:x_ec&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x-distance to elastic center from point about which above structural properties are computed (airfoil aligned coordinate system)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;beam:y_ec&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y-distance to elastic center from point about which above structural properties are computed&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="StrucBase"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.StrucBase">[docs]</a><span class="k">class</span> <span class="nc">StrucBase</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StrucBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># all inputs/outputs in airfoil coordinate system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Px_defl&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed load (force per unit length) in airfoil x-direction at max deflection condition&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Py_defl&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed load (force per unit length) in airfoil y-direction at max deflection condition&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Pz_defl&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed load (force per unit length) in airfoil z-direction at max deflection condition&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Px_strain&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed load (force per unit length) in airfoil x-direction at max strain condition&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Py_strain&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed load (force per unit length) in airfoil y-direction at max strain condition&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Pz_strain&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed load (force per unit length) in airfoil z-direction at max strain condition&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Px_pc_defl&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed load (force per unit length) in airfoil x-direction for deflection used in generated power curve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Py_pc_defl&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed load (force per unit length) in airfoil y-direction for deflection used in generated power curve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Pz_pc_defl&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed load (force per unit length) in airfoil z-direction for deflection used in generated power curve&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;xu_strain_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x-position of midpoint of spar cap on upper surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;xl_strain_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x-position of midpoint of spar cap on lower surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;yu_strain_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y-position of midpoint of spar cap on upper surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;yl_strain_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y-position of midpoint of spar cap on lower surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;xu_strain_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x-position of midpoint of trailing-edge panel on upper surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;xl_strain_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x-position of midpoint of trailing-edge panel on lower surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;yu_strain_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y-position of midpoint of trailing-edge panel on upper surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;yl_strain_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y-position of midpoint of trailing-edge panel on lower surface for strain calculation&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Mx_damage&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;damage equivalent moments about airfoil x-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;My_damage&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;damage equivalent moments about airfoil y-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;strain_ult_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;ultimate strain in spar cap&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;strain_ult_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;uptimate strain in trailing-edge panels&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_fatigue&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor for fatigue&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;m_damage&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;slope of S-N curve for fatigue analysis&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;lifetime&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;number of years used in fatigue analysis&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:z&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;locations of properties along beam&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:EA&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial stiffness&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:EIxx&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;edgewise stiffness (bending about :ref:`x-direction of airfoil aligned coordinate system &lt;blade_airfoil_coord&gt;`)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:EIyy&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;flatwise stiffness (bending about y-direction of airfoil aligned coordinate system)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:EIxy&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;coupled flap-edge stiffness&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:GJ&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;torsional stiffness (about axial z-direction of airfoil aligned coordinate system)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:rhoA&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass per unit length&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:rhoJ&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;polar mass moment of inertia per unit length&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:x_ec&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x-distance to elastic center from point about which above structural properties are computed (airfoil aligned coordinate system)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:y_ec&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y-distance to elastic center from point about which above structural properties are computed&#39;</span><span class="p">)</span>

        <span class="c1"># outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;blade_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass of one blades&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;blade_moment_of_inertia&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;out of plane moment of inertia of a blade&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;first nF natural frequencies of blade&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;dx_defl&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflection of blade section in airfoil x-direction under max deflection loading&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;dy_defl&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflection of blade section in airfoil y-direction under max deflection loading&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;dz_defl&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflection of blade section in airfoil z-direction under max deflection loading&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;dx_pc_defl&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflection of blade section in airfoil x-direction under power curve loading&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;dy_pc_defl&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflection of blade section in airfoil y-direction under power curve loading&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;dz_pc_defl&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflection of blade section in airfoil z-direction under power curve loading&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;strainU_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;strain in spar cap on upper surface at location xu,yu_strain with loads P_strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;strainL_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;strain in spar cap on lower surface at location xl,yl_strain with loads P_strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;strainU_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;strain in trailing-edge panels on upper surface at location xu,yu_te with loads P_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;strainL_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;strain in trailing-edge panels on lower surface at location xl,yl_te with loads P_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;damageU_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on upper surface in spar cap&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;damageL_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on lower surface in spar cap&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;damageU_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on upper surface in trailing-edge panels&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;damageL_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on lower surface in trailing-edge panels&#39;</span><span class="p">)</span></div>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">class aeroloads(Component):</span>
<span class="sd">    def __init__(self):</span>
<span class="sd">        super(aeroloads, self).__init__()</span>
<span class="sd">        self.add_param(&#39;r&#39;, val=0.0, units=&#39;m&#39;, desc=&#39;radial positions along blade going toward tip&#39;)</span>
<span class="sd">        self.add_param(&#39;Px&#39;, val=0.0, units=&#39;N/m&#39;, desc=&#39;distributed loads in blade-aligned x-direction&#39;)</span>
<span class="sd">        self.add_param(&#39;Py&#39;, val=0.0, units=&#39;N/m&#39;, desc=&#39;distributed loads in blade-aligned y-direction&#39;)</span>
<span class="sd">        self.add_param(&#39;Pz&#39;, val=0.0, units=&#39;N/m&#39;, desc=&#39;distributed loads in blade-aligned z-direction&#39;)</span>

<span class="sd">        self.add_param(&#39;V&#39;, val=0.0, units=&#39;m/s&#39;, desc=&#39;hub height wind speed&#39;)</span>
<span class="sd">        self.add_param(&#39;Omega&#39;, val=0.0, units=&#39;rpm&#39;, desc=&#39;rotor rotation speed&#39;)</span>
<span class="sd">        self.add_param(&#39;pitch&#39;, val=0.0, units=&#39;deg&#39;, desc=&#39;pitch angle&#39;)</span>
<span class="sd">        self.add_param(&#39;T&#39;, val=0.0, units=&#39;deg&#39;, desc=&#39;azimuthal angle&#39;)</span>
<span class="sd">&#39;&#39;&#39;</span>
        
<span class="c1"># ---------------------</span>
<span class="c1"># Components</span>
<span class="c1"># ---------------------</span>

<div class="viewcode-block" id="ResizeCompositeSection"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.ResizeCompositeSection">[docs]</a><span class="k">class</span> <span class="nc">ResizeCompositeSection</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ResizeCompositeSection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;structural chord distribution&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;sparT&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;structural spar cap thickness distribution&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;teT&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;structural trailing-edge panel thickness distribution&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;upperCS_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;list of CompositeSection objections defining the properties for upper surface&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;lowerCS_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;list of CompositeSection objections defining the properties for lower surface&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;websCS_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;list of CompositeSection objections defining the properties for shear webs&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;chord_ref&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Chord distribution for reference section, thickness of structural layup scaled with reference thickness (fixed t/c)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;sector_idx_strain_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Index of sector for spar (PreComp definition of sector)&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;sector_idx_strain_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Index of sector for trailing edge (PreComp definition of sector)&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;upperCS&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;list of CompositeSection objections defining the properties for upper surface&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;lowerCS&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;list of CompositeSection objections defining the properties for lower surface&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;websCS&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;list of CompositeSection objections defining the properties for shear webs&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fd&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-5</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="n">chord</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;chord&#39;</span><span class="p">]</span>
        <span class="n">sparT</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sparT&#39;</span><span class="p">]</span>
        <span class="n">teT</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;teT&#39;</span><span class="p">]</span>
        <span class="n">upperCS</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;upperCS_in&#39;</span><span class="p">]</span>
        <span class="n">lowerCS</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;lowerCS_in&#39;</span><span class="p">]</span>
        <span class="n">websCS</span>  <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;websCS_in&#39;</span><span class="p">]</span>
        <span class="n">strain_idx_spar</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sector_idx_strain_spar&#39;</span><span class="p">]</span>
        <span class="n">strain_idx_te</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sector_idx_strain_te&#39;</span><span class="p">]</span>

        <span class="c1"># scale all thicknesses with airfoil thickness</span>
        <span class="c1"># TODO: remove fixed t/c assumption</span>
        <span class="c1"># factor = t_str / tref</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">chord</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;chord_ref&#39;</span><span class="p">]</span>  <span class="c1"># same as thickness ratio for constant t/c</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chord</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>

            <span class="n">upperCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">*</span><span class="n">factor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">upperCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
            <span class="n">lowerCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">*</span><span class="n">factor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">lowerCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
            <span class="n">websCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span>  <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">*</span><span class="n">factor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">websCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>

            <span class="n">idx_spar</span> <span class="o">=</span> <span class="n">strain_idx_spar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">idx_te</span> <span class="o">=</span> <span class="n">strain_idx_te</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># upper and lower have same thickness for this design</span>
            <span class="n">tspar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">upperCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_spar</span><span class="p">])</span>
            <span class="n">tte</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">upperCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_te</span><span class="p">])</span>

            <span class="n">upperCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_spar</span><span class="p">]</span> <span class="o">*=</span> <span class="n">sparT</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">tspar</span>
            <span class="n">lowerCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_spar</span><span class="p">]</span> <span class="o">*=</span> <span class="n">sparT</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">tspar</span>

            <span class="n">upperCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_te</span><span class="p">]</span> <span class="o">*=</span> <span class="n">teT</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">tte</span>
            <span class="n">lowerCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_te</span><span class="p">]</span> <span class="o">*=</span> <span class="n">teT</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">tte</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;upperCS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">upperCS</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;lowerCS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowerCS</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;websCS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">websCS</span></div>



<div class="viewcode-block" id="PreCompSections"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.PreCompSections">[docs]</a><span class="k">class</span> <span class="nc">PreCompSections</span><span class="p">(</span><span class="n">BeamPropertiesBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PreCompSections</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">NPTS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;radial positions. r[0] should be the hub location </span><span class="se">\</span>
<span class="s1">            while r[-1] should be the blade tip. Any number </span><span class="se">\</span>
<span class="s1">            of locations can be specified between these in ascending order.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;array of chord lengths at corresponding radial positions&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;array of twist angles at corresponding radial positions. </span><span class="se">\</span>
<span class="s1">            (positive twist decreases angle of attack)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;le_location&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Leading-edge positions from a reference blade axis (usually blade pitch axis). Locations are normalized by the local chord length. Positive in -x direction for airfoil-aligned coordinate system&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;materials&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;material properties of composite materials&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;upperCS&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;list of CompositeSection objections defining the properties for upper surface&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;lowerCS&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;list of CompositeSection objections defining the properties for lower surface&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;websCS&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;list of CompositeSection objections defining the properties for shear webs&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;list of CompositeSection profiles&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;sector_idx_strain_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Index of sector for spar (PreComp definition of sector)&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;sector_idx_strain_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Index of sector for trailing edge (PreComp definition of sector)&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;eps_crit_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;critical strain in spar from panel buckling calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;eps_crit_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;critical strain in trailing-edge panels from panel buckling calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;xu_strain_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x-position of midpoint of spar cap on upper surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;xl_strain_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x-position of midpoint of spar cap on lower surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;yu_strain_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y-position of midpoint of spar cap on upper surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;yl_strain_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y-position of midpoint of spar cap on lower surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;xu_strain_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x-position of midpoint of trailing-edge panel on upper surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;xl_strain_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x-position of midpoint of trailing-edge panel on lower surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;yu_strain_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y-position of midpoint of trailing-edge panel on upper surface for strain calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;yl_strain_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y-position of midpoint of trailing-edge panel on lower surface for strain calculation&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fd&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-5</span>


    <span class="k">def</span> <span class="nf">criticalStrainLocations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">sector_idx_strain</span><span class="p">,</span> <span class="n">x_ec_nose</span><span class="p">,</span> <span class="n">y_ec_nose</span><span class="p">):</span>

        <span class="n">chord</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;chord&#39;</span><span class="p">]</span>
        <span class="n">upperCS</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;upperCS&#39;</span><span class="p">]</span>
        <span class="n">lowerCS</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;lowerCS&#39;</span><span class="p">]</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;profile&#39;</span><span class="p">]</span>
        <span class="n">NPTS</span>    <span class="o">=</span> <span class="n">chord</span><span class="o">.</span><span class="n">size</span>

        <span class="c1"># find corresponding locations on airfoil at midpoint of sector</span>
        <span class="n">xun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">)</span>
        <span class="n">xln</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">)</span>
        <span class="n">yun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">)</span>
        <span class="n">yln</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NPTS</span><span class="p">):</span>
            <span class="n">csU</span> <span class="o">=</span> <span class="n">upperCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">csL</span> <span class="o">=</span> <span class="n">lowerCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">pf</span>  <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">sector_idx_strain</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">xun</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">csU</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">csU</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">xln</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">csL</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">csL</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">yun</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xun</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pf</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pf</span><span class="o">.</span><span class="n">yu</span><span class="p">)</span>
            <span class="n">yln</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xln</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pf</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pf</span><span class="o">.</span><span class="n">yl</span><span class="p">)</span>

        <span class="c1"># make dimensional and define relative to elastic center</span>
        <span class="n">xu</span> <span class="o">=</span> <span class="n">xun</span><span class="o">*</span><span class="n">chord</span> <span class="o">-</span> <span class="n">x_ec_nose</span>
        <span class="n">xl</span> <span class="o">=</span> <span class="n">xln</span><span class="o">*</span><span class="n">chord</span> <span class="o">-</span> <span class="n">x_ec_nose</span>
        <span class="n">yu</span> <span class="o">=</span> <span class="n">yun</span><span class="o">*</span><span class="n">chord</span> <span class="o">-</span> <span class="n">y_ec_nose</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="n">yln</span><span class="o">*</span><span class="n">chord</span> <span class="o">-</span> <span class="n">y_ec_nose</span>


        <span class="c1"># switch to airfoil coordinate system</span>
        <span class="n">xu</span><span class="p">,</span> <span class="n">yu</span> <span class="o">=</span> <span class="n">yu</span><span class="p">,</span> <span class="n">xu</span>
        <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span> <span class="o">=</span> <span class="n">yl</span><span class="p">,</span> <span class="n">xl</span>

        <span class="k">return</span> <span class="n">xu</span><span class="p">,</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yu</span><span class="p">,</span> <span class="n">yl</span>


    <span class="k">def</span> <span class="nf">panelBucklingStrain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">sector_idx_strain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        see chapter on Structural Component Design Techniques from Alastair Johnson</span>
<span class="sd">        section 6.2: Design of composite panels</span>

<span class="sd">        assumes: large aspect ratio, simply supported, uniaxial compression, flat rectangular plate</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># rename</span>
        <span class="n">chord</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;chord&#39;</span><span class="p">]</span>
        <span class="n">CS_list</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;upperCS&#39;</span><span class="p">]</span>

        <span class="c1"># initialize</span>
        <span class="n">nsec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chord</span><span class="p">)</span>
        <span class="n">eps_crit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsec</span><span class="p">):</span>

            <span class="n">cs</span> <span class="o">=</span> <span class="n">CS_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">sector_idx</span> <span class="o">=</span> <span class="n">sector_idx_strain</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># chord-wise length of sector</span>
            <span class="n">sector_length</span> <span class="o">=</span> <span class="n">chord</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sector_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sector_idx</span><span class="p">])</span>

            <span class="c1"># get matrices</span>
            <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">totalHeight</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">compositeMatrices</span><span class="p">(</span><span class="n">sector_idx</span><span class="p">)</span>
            <span class="n">E</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">effectiveEAxial</span><span class="p">(</span><span class="n">sector_idx</span><span class="p">)</span>
            <span class="n">D1</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">D2</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">D3</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="c1"># use empirical formula</span>
            <span class="n">Nxx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">sector_length</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D1</span><span class="o">*</span><span class="n">D2</span><span class="p">)</span> <span class="o">+</span> <span class="n">D3</span><span class="p">)</span>

            <span class="n">eps_crit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">Nxx</span> <span class="o">/</span> <span class="n">totalHeight</span> <span class="o">/</span> <span class="n">E</span>

        <span class="k">return</span> <span class="n">eps_crit</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="n">r</span>       <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
        <span class="n">chord</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;chord&#39;</span><span class="p">]</span>
        <span class="n">mat</span>     <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span>
        <span class="n">leLoc</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;le_location&#39;</span><span class="p">]</span>
        <span class="n">upperCS</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;upperCS&#39;</span><span class="p">]</span>
        <span class="n">lowerCS</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;lowerCS&#39;</span><span class="p">]</span>
        <span class="n">websCS</span>  <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;websCS&#39;</span><span class="p">]</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;profile&#39;</span><span class="p">]</span>
        <span class="n">theta</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span>

        <span class="n">strain_idx_spar</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sector_idx_strain_spar&#39;</span><span class="p">]</span>
        <span class="n">strain_idx_te</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sector_idx_strain_te&#39;</span><span class="p">]</span>
        
        <span class="c1"># radial discretization</span>
        <span class="n">nsec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="c1"># initialize variables</span>
        <span class="n">beam_z</span> <span class="o">=</span> <span class="n">r</span>
        <span class="n">beam_EA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="n">beam_EIxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="n">beam_EIyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="n">beam_EIxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="n">beam_GJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="n">beam_rhoA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="n">beam_rhoJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>

        <span class="c1"># distance to elastic center from point about which structural properties are computed</span>
        <span class="c1"># using airfoil coordinate system</span>
        <span class="n">beam_x_ec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="n">beam_y_ec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>

        <span class="c1"># distance to elastic center from airfoil nose</span>
        <span class="c1"># using profile coordinate system</span>
        <span class="n">x_ec_nose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="n">y_ec_nose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>

        <span class="n">csU</span> <span class="o">=</span> <span class="n">upperCS</span>
        <span class="n">csL</span> <span class="o">=</span> <span class="n">lowerCS</span>
        <span class="n">csW</span> <span class="o">=</span> <span class="n">websCS</span>

        <span class="c1"># twist rate</span>
        <span class="n">th_prime</span> <span class="o">=</span> <span class="n">_precomp</span><span class="o">.</span><span class="n">tw_rate</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

        <span class="c1"># arrange materials into list</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
        <span class="n">E1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
        <span class="n">E2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
        <span class="n">G12</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
        <span class="n">nu12</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">E1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">E1</span>
            <span class="n">E2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">E2</span>
            <span class="n">G12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">G12</span>
            <span class="n">nu12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nu12</span>
            <span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">rho</span>


        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsec</span><span class="p">):</span>

            <span class="n">xnode</span><span class="p">,</span> <span class="n">ynode</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_preCompFormat</span><span class="p">()</span>
            <span class="n">locU</span><span class="p">,</span> <span class="n">n_laminaU</span><span class="p">,</span> <span class="n">n_pliesU</span><span class="p">,</span> <span class="n">tU</span><span class="p">,</span> <span class="n">thetaU</span><span class="p">,</span> <span class="n">mat_idxU</span> <span class="o">=</span> <span class="n">csU</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_preCompFormat</span><span class="p">()</span>
            <span class="n">locL</span><span class="p">,</span> <span class="n">n_laminaL</span><span class="p">,</span> <span class="n">n_pliesL</span><span class="p">,</span> <span class="n">tL</span><span class="p">,</span> <span class="n">thetaL</span><span class="p">,</span> <span class="n">mat_idxL</span> <span class="o">=</span> <span class="n">csL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_preCompFormat</span><span class="p">()</span>
            <span class="n">locW</span><span class="p">,</span> <span class="n">n_laminaW</span><span class="p">,</span> <span class="n">n_pliesW</span><span class="p">,</span> <span class="n">tW</span><span class="p">,</span> <span class="n">thetaW</span><span class="p">,</span> <span class="n">mat_idxW</span> <span class="o">=</span> <span class="n">csW</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_preCompFormat</span><span class="p">()</span>

            <span class="n">nwebs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locW</span><span class="p">)</span>

            <span class="c1"># address a bug in f2py (need to pass in length 1 arrays even though they are not used)</span>
            <span class="k">if</span> <span class="n">nwebs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">locW</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">n_laminaW</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">n_pliesW</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">tW</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">thetaW</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">mat_idxW</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>


            <span class="n">results</span> <span class="o">=</span> <span class="n">_precomp</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">chord</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">th_prime</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">leLoc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">xnode</span><span class="p">,</span> <span class="n">ynode</span><span class="p">,</span> <span class="n">E1</span><span class="p">,</span> <span class="n">E2</span><span class="p">,</span> <span class="n">G12</span><span class="p">,</span> <span class="n">nu12</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span>
                <span class="n">locU</span><span class="p">,</span> <span class="n">n_laminaU</span><span class="p">,</span> <span class="n">n_pliesU</span><span class="p">,</span> <span class="n">tU</span><span class="p">,</span> <span class="n">thetaU</span><span class="p">,</span> <span class="n">mat_idxU</span><span class="p">,</span>
                <span class="n">locL</span><span class="p">,</span> <span class="n">n_laminaL</span><span class="p">,</span> <span class="n">n_pliesL</span><span class="p">,</span> <span class="n">tL</span><span class="p">,</span> <span class="n">thetaL</span><span class="p">,</span> <span class="n">mat_idxL</span><span class="p">,</span>
                <span class="n">nwebs</span><span class="p">,</span> <span class="n">locW</span><span class="p">,</span> <span class="n">n_laminaW</span><span class="p">,</span> <span class="n">n_pliesW</span><span class="p">,</span> <span class="n">tW</span><span class="p">,</span> <span class="n">thetaW</span><span class="p">,</span> <span class="n">mat_idxW</span><span class="p">)</span>


            <span class="n">beam_EIxx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># EIedge</span>
            <span class="n">beam_EIyy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># EIflat</span>
            <span class="n">beam_GJ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">beam_EA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">beam_EIxy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># EIflapedge</span>
            <span class="n">beam_x_ec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
            <span class="n">beam_y_ec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
            <span class="n">beam_rhoA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span>
            <span class="n">beam_rhoJ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">+</span> <span class="n">results</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>  <span class="c1"># perpindicular axis theorem</span>

            <span class="n">x_ec_nose</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">+</span> <span class="n">leLoc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">chord</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">y_ec_nose</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>  <span class="c1"># switch b.c of coordinate system used</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;beam:z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_z</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;beam:EIxx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_EIxx</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;beam:EIyy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_EIyy</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;beam:GJ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_GJ</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;beam:EA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_EA</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;beam:EIxy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_EIxy</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;beam:x_ec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_x_ec</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;beam:y_ec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_y_ec</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;beam:rhoA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_rhoA</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;beam:rhoJ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_rhoJ</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;eps_crit_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">panelBucklingStrain</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">strain_idx_spar</span><span class="p">)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;eps_crit_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">panelBucklingStrain</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">strain_idx_te</span><span class="p">)</span>

        <span class="n">xu_strain_spar</span><span class="p">,</span> <span class="n">xl_strain_spar</span><span class="p">,</span> <span class="n">yu_strain_spar</span><span class="p">,</span> <span class="n">yl_strain_spar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">criticalStrainLocations</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">strain_idx_spar</span><span class="p">,</span> <span class="n">x_ec_nose</span><span class="p">,</span> <span class="n">y_ec_nose</span><span class="p">)</span>
        <span class="n">xu_strain_te</span><span class="p">,</span> <span class="n">xl_strain_te</span><span class="p">,</span> <span class="n">yu_strain_te</span><span class="p">,</span> <span class="n">yl_strain_te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">criticalStrainLocations</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">strain_idx_te</span><span class="p">,</span> <span class="n">x_ec_nose</span><span class="p">,</span> <span class="n">y_ec_nose</span><span class="p">)</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;xu_strain_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xu_strain_spar</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;xl_strain_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xl_strain_spar</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;yu_strain_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yu_strain_spar</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;yl_strain_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yl_strain_spar</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;xu_strain_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xu_strain_te</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;xl_strain_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xl_strain_te</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;yu_strain_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yu_strain_te</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;yl_strain_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yl_strain_te</span></div>

        
<div class="viewcode-block" id="BladeCurvature"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.BladeCurvature">[docs]</a><span class="k">class</span> <span class="nc">BladeCurvature</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BladeCurvature</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;location in blade z-coordinate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;precurve&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;location in blade x-coordinate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;presweep&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;location in blade y-coordinate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;precone&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;precone angle&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;totalCone&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total cone angle from precone and curvature&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;x_az&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;location of blade in azimuth x-coordinate system&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;y_az&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;location of blade in azimuth y-coordinate system&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;z_az&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;location of blade in azimuth z-coordinate system&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;cumulative path length along blade&#39;</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="c1"># self.x_az, self.y_az, self.z_az, cone, s = \</span>
        <span class="c1">#     _bem.definecurvature(self.r, self.precurve, self.presweep, 0.0)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precurve</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;precurve&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">presweep</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;presweep&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precone</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;precone&#39;</span><span class="p">]</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
        <span class="n">dx_dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_az</span><span class="p">,</span> <span class="n">x_azd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_az</span><span class="p">,</span> <span class="n">y_azd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_az</span><span class="p">,</span> <span class="n">z_azd</span><span class="p">,</span> \
            <span class="n">cone</span><span class="p">,</span> <span class="n">coned</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">_bem</span><span class="o">.</span><span class="n">definecurvature_dv2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">dx_dx</span><span class="p">[:,</span> <span class="p">:</span><span class="n">n</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">precurve</span><span class="p">,</span> <span class="n">dx_dx</span><span class="p">[:,</span> <span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">presweep</span><span class="p">,</span> <span class="n">dx_dx</span><span class="p">[:,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">totalCone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precone</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">cone</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;totalCone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalCone</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;x_az&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_az</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;y_az&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_az</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;z_az&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_az</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span>

        <span class="n">dxaz_dr</span> <span class="o">=</span> <span class="n">x_azd</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dxaz_dprecurve</span> <span class="o">=</span> <span class="n">x_azd</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dxaz_dpresweep</span> <span class="o">=</span> <span class="n">x_azd</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dyaz_dr</span> <span class="o">=</span> <span class="n">y_azd</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dyaz_dprecurve</span> <span class="o">=</span> <span class="n">y_azd</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dyaz_dpresweep</span> <span class="o">=</span> <span class="n">y_azd</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dzaz_dr</span> <span class="o">=</span> <span class="n">z_azd</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dzaz_dprecurve</span> <span class="o">=</span> <span class="n">z_azd</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dzaz_dpresweep</span> <span class="o">=</span> <span class="n">z_azd</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dcone_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">coned</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dcone_dprecurve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">coned</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">:])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dcone_dpresweep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">coned</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">T</span>

        <span class="n">ds_dr</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ds_dr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ds_dprecurve</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ds_dpresweep</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>

        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;x_az&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dxaz_dr</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;x_az&#39;</span><span class="p">,</span> <span class="s1">&#39;precurve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dxaz_dprecurve</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;x_az&#39;</span><span class="p">,</span> <span class="s1">&#39;presweep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dxaz_dpresweep</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;x_az&#39;</span><span class="p">,</span> <span class="s1">&#39;precone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;y_az&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dyaz_dr</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;y_az&#39;</span><span class="p">,</span> <span class="s1">&#39;precurve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dyaz_dprecurve</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;y_az&#39;</span><span class="p">,</span> <span class="s1">&#39;presweep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dyaz_dpresweep</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;y_az&#39;</span><span class="p">,</span> <span class="s1">&#39;precone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;z_az&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dzaz_dr</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;z_az&#39;</span><span class="p">,</span> <span class="s1">&#39;precurve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dzaz_dprecurve</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;z_az&#39;</span><span class="p">,</span> <span class="s1">&#39;presweep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dzaz_dpresweep</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;z_az&#39;</span><span class="p">,</span> <span class="s1">&#39;precone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dcone_dr</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;precurve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dcone_dprecurve</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;presweep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dcone_dpresweep</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;precone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_dr</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;precurve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_dprecurve</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;presweep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_dpresweep</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;precone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">J</span> <span class="o">=</span> <span class="n">J</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;precurve&#39;</span><span class="p">,</span> <span class="s1">&#39;presweep&#39;</span><span class="p">,</span> <span class="s1">&#39;precone&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;x_az&#39;</span><span class="p">,</span> <span class="s1">&#39;y_az&#39;</span><span class="p">,</span> <span class="s1">&#39;z_az&#39;</span><span class="p">,</span> <span class="s1">&#39;totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span></div>


<div class="viewcode-block" id="CurveFEM"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.CurveFEM">[docs]</a><span class="k">class</span> <span class="nc">CurveFEM</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CurveFEM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="sd">&quot;&quot;&quot;natural frequencies for curved blades&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Omega&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;rpm&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rotor rotation frequency&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:z&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;locations of properties along beam&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:EA&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial stiffness&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:EIxx&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;edgewise stiffness (bending about :ref:`x-direction of airfoil aligned coordinate system &lt;blade_airfoil_coord&gt;`)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:EIyy&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;flatwise stiffness (bending about y-direction of airfoil aligned coordinate system)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:EIxy&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;coupled flap-edge stiffness&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:GJ&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;torsional stiffness (about axial z-direction of airfoil aligned coordinate system)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:rhoA&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass per unit length&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:rhoJ&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;polar mass moment of inertia per unit length&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:x_ec&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x-distance to elastic center from point about which above structural properties are computed (airfoil aligned coordinate system)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;beam:y_ec&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y-distance to elastic center from point about which above structural properties are computed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;structural twist distribution&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;precurve&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;structural precuve (see FAST definition)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;presweep&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;structural presweep (see FAST definition)&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;first nF natural frequencies&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fd&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-5</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:z&#39;</span><span class="p">]</span>

        <span class="n">rhub</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bladeLength</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bladeFrac</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">rhub</span><span class="p">)</span> <span class="o">/</span> <span class="n">bladeLength</span>

        <span class="n">freq</span> <span class="o">=</span> <span class="n">_curvefem</span><span class="o">.</span><span class="n">frequencies</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">],</span> <span class="n">bladeLength</span><span class="p">,</span> <span class="n">rhub</span><span class="p">,</span> <span class="n">bladeFrac</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">],</span>
                                     <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:rhoA&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:EIxx&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:EIyy&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:GJ&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:EA&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:rhoJ&#39;</span><span class="p">],</span>
                                     <span class="n">params</span><span class="p">[</span><span class="s1">&#39;precurve&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;presweep&#39;</span><span class="p">])</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[:</span><span class="n">NFREQ</span><span class="p">]</span></div>



<div class="viewcode-block" id="RotorWithpBEAM"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.RotorWithpBEAM">[docs]</a><span class="k">class</span> <span class="nc">RotorWithpBEAM</span><span class="p">(</span><span class="n">StrucBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RotorWithpBEAM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">NPTS</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fd&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-5</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EI11</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EI22</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EA</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ca</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sa</span>   <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">principalCS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EIyy</span><span class="p">,</span> <span class="n">EIxx</span><span class="p">,</span> <span class="n">y_ec</span><span class="p">,</span> <span class="n">x_ec</span><span class="p">,</span> <span class="n">EA</span><span class="p">,</span> <span class="n">EIxy</span><span class="p">):</span>

        <span class="c1"># rename (with swap of x, y for profile c.s.)</span>
        <span class="n">EIxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">EIyy</span><span class="p">)</span>
        <span class="n">EIyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">EIxx</span><span class="p">)</span>
        <span class="n">x_ec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">y_ec</span><span class="p">)</span>
        <span class="n">y_ec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x_ec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">EA</span><span class="p">)</span>
        <span class="n">EIxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">EIxy</span><span class="p">)</span>

        <span class="c1"># translate to elastic center</span>
        <span class="n">EIxx</span> <span class="o">-=</span> <span class="n">y_ec</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">EA</span>
        <span class="n">EIyy</span> <span class="o">-=</span> <span class="n">x_ec</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">EA</span>
        <span class="n">EIxy</span> <span class="o">-=</span> <span class="n">x_ec</span><span class="o">*</span><span class="n">y_ec</span><span class="o">*</span><span class="n">EA</span>

        <span class="c1"># get rotation angle</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">EIxy</span><span class="p">,</span> <span class="n">EIyy</span><span class="o">-</span><span class="n">EIxx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EI11</span> <span class="o">=</span> <span class="n">EIxx</span> <span class="o">-</span> <span class="n">EIxy</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EI22</span> <span class="o">=</span> <span class="n">EIyy</span> <span class="o">+</span> <span class="n">EIxy</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

        <span class="c1"># get moments and positions in principal axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">strain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blade</span><span class="p">,</span> <span class="n">xu</span><span class="p">,</span> <span class="n">yu</span><span class="p">,</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">):</span>

        <span class="n">Vx</span><span class="p">,</span> <span class="n">Vy</span><span class="p">,</span> <span class="n">Fz</span><span class="p">,</span> <span class="n">Mx</span><span class="p">,</span> <span class="n">My</span><span class="p">,</span> <span class="n">Tz</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="n">shearAndBending</span><span class="p">()</span>

        <span class="c1"># use profile c.s. to use Hansen&#39;s notation</span>
        <span class="n">Vx</span><span class="p">,</span> <span class="n">Vy</span> <span class="o">=</span> <span class="n">Vy</span><span class="p">,</span> <span class="n">Vx</span>
        <span class="n">Mx</span><span class="p">,</span> <span class="n">My</span> <span class="o">=</span> <span class="n">My</span><span class="p">,</span> <span class="n">Mx</span>
        <span class="n">xu</span><span class="p">,</span> <span class="n">yu</span> <span class="o">=</span> <span class="n">yu</span><span class="p">,</span> <span class="n">xu</span>
        <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span> <span class="o">=</span> <span class="n">yl</span><span class="p">,</span> <span class="n">xl</span>

        <span class="c1"># convert to principal xes</span>
        <span class="n">M1</span> <span class="o">=</span> <span class="n">Mx</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">+</span> <span class="n">My</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span>
        <span class="n">M2</span> <span class="o">=</span> <span class="o">-</span><span class="n">Mx</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span> <span class="o">+</span> <span class="n">My</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">xu</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">+</span> <span class="n">yu</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">xu</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span> <span class="o">+</span> <span class="n">yu</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span>

        <span class="c1"># compute strain</span>
        <span class="n">strainU</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">M1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EI11</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">M2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EI22</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">Fz</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EA</span><span class="p">)</span>  <span class="c1"># negative sign because 3 is opposite of z</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">xl</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">+</span> <span class="n">yl</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">xl</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span> <span class="o">+</span> <span class="n">yl</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span>

        <span class="n">strainL</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">M1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EI11</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">M2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EI22</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">Fz</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EA</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">strainU</span><span class="p">,</span> <span class="n">strainL</span>

    <span class="k">def</span> <span class="nf">damage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Mx</span><span class="p">,</span> <span class="n">My</span><span class="p">,</span> <span class="n">xu</span><span class="p">,</span> <span class="n">yu</span><span class="p">,</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="mf">1.755</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="o">*</span><span class="mi">24</span><span class="p">):</span>

        <span class="c1"># use profil ec.s. to use Hansen&#39;s notation</span>
        <span class="n">Mx</span><span class="p">,</span> <span class="n">My</span> <span class="o">=</span> <span class="n">My</span><span class="p">,</span> <span class="n">Mx</span>
        <span class="n">Fz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">xu</span><span class="p">,</span> <span class="n">yu</span> <span class="o">=</span> <span class="n">yu</span><span class="p">,</span> <span class="n">xu</span>
        <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span> <span class="o">=</span> <span class="n">yl</span><span class="p">,</span> <span class="n">xl</span>

        <span class="c1"># convert to principal xes</span>
        <span class="n">M1</span> <span class="o">=</span> <span class="n">Mx</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">+</span> <span class="n">My</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span>
        <span class="n">M2</span> <span class="o">=</span> <span class="o">-</span><span class="n">Mx</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span> <span class="o">+</span> <span class="n">My</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">xu</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">+</span> <span class="n">yu</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">xu</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span> <span class="o">+</span> <span class="n">yu</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span>

        <span class="c1"># compute strain</span>
        <span class="n">strainU</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">M1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EI11</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">M2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EI22</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">Fz</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EA</span><span class="p">)</span>  <span class="c1"># negative sign because 3 is opposite of z</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">xl</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">+</span> <span class="n">yl</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">xl</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span> <span class="o">+</span> <span class="n">yl</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span>

        <span class="n">strainL</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">M1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EI11</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">M2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EI22</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">Fz</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EA</span><span class="p">)</span>

        <span class="c1"># number of cycles to failure</span>
        <span class="n">NfU</span> <span class="o">=</span> <span class="p">(</span><span class="n">emax</span><span class="o">/</span><span class="p">(</span><span class="n">eta</span><span class="o">*</span><span class="n">strainU</span><span class="p">))</span><span class="o">**</span><span class="n">m</span>
        <span class="n">NfL</span> <span class="o">=</span> <span class="p">(</span><span class="n">emax</span><span class="o">/</span><span class="p">(</span><span class="n">eta</span><span class="o">*</span><span class="n">strainL</span><span class="p">))</span><span class="o">**</span><span class="n">m</span>

        <span class="c1"># damage- use log-based utilization version</span>
        <span class="c1">#damageU = N/NfU</span>
        <span class="c1">#damageL = N/NfL</span>

        <span class="n">damageU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">emax</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">strainU</span><span class="p">)))</span>
        <span class="n">damageL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">emax</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">strainL</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">damageU</span><span class="p">,</span> <span class="n">damageL</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="n">Px_defl</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Px_defl&#39;</span><span class="p">]</span>
        <span class="n">Py_defl</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Py_defl&#39;</span><span class="p">]</span>
        <span class="n">Pz_defl</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Pz_defl&#39;</span><span class="p">]</span>

        <span class="n">Px_defl</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Px_defl&#39;</span><span class="p">]</span>
        <span class="n">Py_defl</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Py_defl&#39;</span><span class="p">]</span>
        <span class="n">Pz_defl</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Pz_defl&#39;</span><span class="p">]</span>
        <span class="n">Px_strain</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Px_strain&#39;</span><span class="p">]</span>
        <span class="n">Py_strain</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Py_strain&#39;</span><span class="p">]</span>
        <span class="n">Pz_strain</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Pz_strain&#39;</span><span class="p">]</span>
        <span class="n">Px_pc_defl</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Px_pc_defl&#39;</span><span class="p">]</span>
        <span class="n">Py_pc_defl</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Py_pc_defl&#39;</span><span class="p">]</span>
        <span class="n">Pz_pc_defl</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Pz_pc_defl&#39;</span><span class="p">]</span>

        <span class="n">xu_strain_spar</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;xu_strain_spar&#39;</span><span class="p">]</span>
        <span class="n">xl_strain_spar</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;xl_strain_spar&#39;</span><span class="p">]</span>
        <span class="n">yu_strain_spar</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;yu_strain_spar&#39;</span><span class="p">]</span>
        <span class="n">yl_strain_spar</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;yl_strain_spar&#39;</span><span class="p">]</span>
        <span class="n">xu_strain_te</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;xu_strain_te&#39;</span><span class="p">]</span>
        <span class="n">xu_strain_te</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;xu_strain_te&#39;</span><span class="p">]</span>
        <span class="n">xl_strain_te</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;xl_strain_te&#39;</span><span class="p">]</span>
        <span class="n">yu_strain_te</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;yu_strain_te&#39;</span><span class="p">]</span>
        <span class="n">yl_strain_te</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;yl_strain_te&#39;</span><span class="p">]</span>

        <span class="n">Mx_damage</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mx_damage&#39;</span><span class="p">]</span>
        <span class="n">My_damage</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;My_damage&#39;</span><span class="p">]</span>
        <span class="n">strain_ult_spar</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strain_ult_spar&#39;</span><span class="p">]</span>
        <span class="n">strain_ult_te</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strain_ult_te&#39;</span><span class="p">]</span>
        <span class="n">gamma_fatigue</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_fatigue&#39;</span><span class="p">]</span>
        <span class="n">m_damage</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;m_damage&#39;</span><span class="p">]</span>
        <span class="n">N_damage</span> <span class="o">=</span> <span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;lifetime&#39;</span><span class="p">]</span>

        <span class="c1"># outputs</span>
        <span class="n">nsec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:z&#39;</span><span class="p">])</span>

        <span class="c1"># create finite element objects</span>
        <span class="n">p_section</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">SectionData</span><span class="p">(</span><span class="n">nsec</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:z&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:EA&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:EIxx&#39;</span><span class="p">],</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:EIyy&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:GJ&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:rhoA&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:rhoJ&#39;</span><span class="p">])</span>
        <span class="n">p_tip</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">TipData</span><span class="p">()</span>  <span class="c1"># no tip mass</span>
        <span class="n">p_base</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">BaseData</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># rigid base</span>


        <span class="c1"># ----- tip deflection -----</span>

        <span class="c1"># evaluate displacements</span>
        <span class="n">p_loads</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Loads</span><span class="p">(</span><span class="n">nsec</span><span class="p">,</span> <span class="n">Px_defl</span><span class="p">,</span> <span class="n">Py_defl</span><span class="p">,</span> <span class="n">Pz_defl</span><span class="p">)</span>
        <span class="n">blade</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Beam</span><span class="p">(</span><span class="n">p_section</span><span class="p">,</span> <span class="n">p_loads</span><span class="p">,</span> <span class="n">p_tip</span><span class="p">,</span> <span class="n">p_base</span><span class="p">)</span>
        <span class="n">dx_defl</span><span class="p">,</span> <span class="n">dy_defl</span><span class="p">,</span> <span class="n">dz_defl</span><span class="p">,</span> <span class="n">dtheta_r1</span><span class="p">,</span> <span class="n">dtheta_r2</span><span class="p">,</span> <span class="n">dtheta_z</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="n">displacement</span><span class="p">()</span>

        <span class="n">p_loads</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Loads</span><span class="p">(</span><span class="n">nsec</span><span class="p">,</span> <span class="n">Px_pc_defl</span><span class="p">,</span> <span class="n">Py_pc_defl</span><span class="p">,</span> <span class="n">Pz_pc_defl</span><span class="p">)</span>
        <span class="n">blade</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Beam</span><span class="p">(</span><span class="n">p_section</span><span class="p">,</span> <span class="n">p_loads</span><span class="p">,</span> <span class="n">p_tip</span><span class="p">,</span> <span class="n">p_base</span><span class="p">)</span>
        <span class="n">dx_pc_defl</span><span class="p">,</span> <span class="n">dy_pc_defl</span><span class="p">,</span> <span class="n">dz_pc_defl</span><span class="p">,</span> <span class="n">dtheta_r1</span><span class="p">,</span> <span class="n">dtheta_r2</span><span class="p">,</span> <span class="n">dtheta_z</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="n">displacement</span><span class="p">()</span>


        <span class="c1"># --- mass ---</span>
        <span class="n">blade_mass</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="n">mass</span><span class="p">()</span>

        <span class="c1"># --- moments of inertia</span>
        <span class="n">blade_moment_of_inertia</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="n">outOfPlaneMomentOfInertia</span><span class="p">()</span>

        <span class="c1"># ----- natural frequencies ----</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="n">naturalFrequencies</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">)</span>

        <span class="c1"># ----- strain -----</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">principalCS</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:EIyy&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:EIxx&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:y_ec&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:x_ec&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:EA&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beam:EIxy&#39;</span><span class="p">])</span>

        <span class="n">p_loads</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Loads</span><span class="p">(</span><span class="n">nsec</span><span class="p">,</span> <span class="n">Px_strain</span><span class="p">,</span> <span class="n">Py_strain</span><span class="p">,</span> <span class="n">Pz_strain</span><span class="p">)</span>

        <span class="n">blade</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Beam</span><span class="p">(</span><span class="n">p_section</span><span class="p">,</span> <span class="n">p_loads</span><span class="p">,</span> <span class="n">p_tip</span><span class="p">,</span> <span class="n">p_base</span><span class="p">)</span>

        <span class="n">strainU_spar</span><span class="p">,</span> <span class="n">strainL_spar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strain</span><span class="p">(</span><span class="n">blade</span><span class="p">,</span> <span class="n">xu_strain_spar</span><span class="p">,</span> <span class="n">yu_strain_spar</span><span class="p">,</span> <span class="n">xl_strain_spar</span><span class="p">,</span> <span class="n">yl_strain_spar</span><span class="p">)</span>

        <span class="n">strainU_te</span><span class="p">,</span> <span class="n">strainL_te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strain</span><span class="p">(</span><span class="n">blade</span><span class="p">,</span> <span class="n">xu_strain_te</span><span class="p">,</span> <span class="n">yu_strain_te</span><span class="p">,</span> <span class="n">xl_strain_te</span><span class="p">,</span> <span class="n">yl_strain_te</span><span class="p">)</span>

        <span class="n">damageU_spar</span><span class="p">,</span> <span class="n">damageL_spar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage</span><span class="p">(</span><span class="n">Mx_damage</span><span class="p">,</span> <span class="n">My_damage</span><span class="p">,</span> <span class="n">xu_strain_spar</span><span class="p">,</span> <span class="n">yu_strain_spar</span><span class="p">,</span> <span class="n">xl_strain_spar</span><span class="p">,</span> <span class="n">yl_strain_spar</span><span class="p">,</span>
                                                 <span class="n">emax</span><span class="o">=</span><span class="n">strain_ult_spar</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">gamma_fatigue</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">m_damage</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N_damage</span><span class="p">)</span>

        <span class="n">damageU_te</span><span class="p">,</span> <span class="n">damageL_te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage</span><span class="p">(</span><span class="n">Mx_damage</span><span class="p">,</span> <span class="n">My_damage</span><span class="p">,</span> <span class="n">xu_strain_te</span><span class="p">,</span> <span class="n">yu_strain_te</span><span class="p">,</span> <span class="n">xl_strain_te</span><span class="p">,</span> <span class="n">yl_strain_te</span><span class="p">,</span>
                                             <span class="n">emax</span><span class="o">=</span><span class="n">strain_ult_te</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">gamma_fatigue</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">m_damage</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N_damage</span><span class="p">)</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;blade_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blade_mass</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;blade_moment_of_inertia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blade_moment_of_inertia</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;dx_defl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dx_defl</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;dy_defl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dy_defl</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;dz_defl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dz_defl</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;dx_pc_defl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dx_pc_defl</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;dy_pc_defl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dy_pc_defl</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;dz_pc_defl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dz_pc_defl</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;strainU_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strainU_spar</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;strainL_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strainL_spar</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;strainU_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strainU_te</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;strainL_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strainL_te</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;damageU_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">damageU_spar</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;damageL_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">damageL_spar</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;damageU_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">damageU_te</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;damageL_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">damageL_te</span></div>
        

<div class="viewcode-block" id="DamageLoads"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.DamageLoads">[docs]</a><span class="k">class</span> <span class="nc">DamageLoads</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DamageLoads</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;rstar&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;nondimensional radial locations of damage equivalent moments&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Mxb&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;damage equivalent moments about blade c.s. x-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Myb&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;damage equivalent moments about blade c.s. y-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;structural twist&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;structural radial locations&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mxa&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;damage equivalent moments about airfoil c.s. x-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mya&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;damage equivalent moments about airfoil c.s. y-direction&#39;</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rstar</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rstar&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mxb</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mxb&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Myb</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Myb&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>

        <span class="n">rstar</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">Mxb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_drstarstr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_drstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_dMxb</span> <span class="o">=</span> \
            <span class="n">akima_interp_with_derivs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mxb</span><span class="p">,</span> <span class="n">rstar</span><span class="p">)</span>

        <span class="n">Myb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_drstarstr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_drstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_dMyb</span> <span class="o">=</span> \
            <span class="n">akima_interp_with_derivs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Myb</span><span class="p">,</span> <span class="n">rstar</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ma</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="n">Mxb</span><span class="p">,</span> <span class="n">Myb</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">bladeToAirfoil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mxa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mya</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">y</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Mxa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mxa</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Mya&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mya</span>

    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;rstar&#39;</span><span class="p">,</span> <span class="s1">&#39;Mxb&#39;</span><span class="p">,</span> <span class="s1">&#39;Myb&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Mxa&#39;</span><span class="p">,</span> <span class="s1">&#39;Mya&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
        <span class="n">drstarstr_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">drstarstr_dr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">drstarstr_dr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">drstarstr_dr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>

        <span class="n">dMxbstr_drstarstr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_drstarstr</span><span class="p">)</span>
        <span class="n">dMybstr_drstarstr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_drstarstr</span><span class="p">)</span>

        <span class="n">dMxbstr_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMxbstr_drstarstr</span><span class="p">,</span> <span class="n">drstarstr_dr</span><span class="p">)</span>
        <span class="n">dMybstr_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMybstr_drstarstr</span><span class="p">,</span> <span class="n">drstarstr_dr</span><span class="p">)</span>

        <span class="n">dMxa_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]),</span> <span class="n">dMxbstr_dr</span><span class="p">)</span>\
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]),</span> <span class="n">dMybstr_dr</span><span class="p">)</span>
        <span class="n">dMxa_drstar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_drstar</span><span class="p">)</span>\
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_drstar</span><span class="p">)</span>
        <span class="n">dMxa_dMxb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_dMxb</span><span class="p">)</span>
        <span class="n">dMxa_dMyb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_dMyb</span><span class="p">)</span>
        <span class="n">dMxa_dtheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dtheta&#39;</span><span class="p">])</span>

        <span class="n">dMya_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]),</span> <span class="n">dMxbstr_dr</span><span class="p">)</span>\
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]),</span> <span class="n">dMybstr_dr</span><span class="p">)</span>
        <span class="n">dMya_drstar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_drstar</span><span class="p">)</span>\
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_drstar</span><span class="p">)</span>
        <span class="n">dMya_dMxb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_dMxb</span><span class="p">)</span>
        <span class="n">dMya_dMyb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_dMyb</span><span class="p">)</span>
        <span class="n">dMya_dtheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dtheta&#39;</span><span class="p">])</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mxa&#39;</span><span class="p">,</span> <span class="s1">&#39;rstar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dMxa_drstar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mxa&#39;</span><span class="p">,</span> <span class="s1">&#39;Mxb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dMxa_dMxb</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mxa&#39;</span><span class="p">,</span> <span class="s1">&#39;Myb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dMxa_dMyb</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mxa&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dMxa_dtheta</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mxa&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dMxa_dr</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mya&#39;</span><span class="p">,</span> <span class="s1">&#39;rstar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dMya_drstar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mya&#39;</span><span class="p">,</span> <span class="s1">&#39;Mxb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dMya_dMxb</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mya&#39;</span><span class="p">,</span> <span class="s1">&#39;Myb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dMya_dMyb</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mya&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dMya_dtheta</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mya&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dMya_dr</span>

        <span class="k">return</span> <span class="n">J</span></div>


<div class="viewcode-block" id="TotalLoads"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.TotalLoads">[docs]</a><span class="k">class</span> <span class="nc">TotalLoads</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TotalLoads</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;aeroloads_r&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;radial positions along blade going toward tip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;aeroloads_Px&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed loads in blade-aligned x-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;aeroloads_Py&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed loads in blade-aligned y-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;aeroloads_Pz&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed loads in blade-aligned z-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;aeroloads_Omega&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;rpm&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rotor rotation speed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;aeroloads_pitch&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;pitch angle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;aeroloads_azimuth&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;azimuthal angle&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;structural radial locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;structural twist&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;tilt angle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;totalCone&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total cone angle from precone and curvature&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;z_az&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;location of blade in azimuth z-coordinate system&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;rhoA&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass per unit length&#39;</span><span class="p">)</span>

        <span class="c1"># outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total distributed loads in airfoil x-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total distributed loads in airfoil y-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total distributed loads in airfoil z-direction&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>


    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tilt</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalCone</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;totalCone&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_az</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;z_az&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rhoA&#39;</span><span class="p">]</span>


        <span class="c1"># totalCone = self.precone</span>
        <span class="c1"># z_az = self.r*cosd(self.precone)</span>
        <span class="n">totalCone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalCone</span>
        <span class="n">z_az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_az</span>

        <span class="c1"># keep all in blade c.s. then rotate all at end</span>

        <span class="c1"># rename</span>
        <span class="c1"># aero = self.aeroloads</span>

        <span class="c1"># --- aero loads ---</span>

        <span class="c1"># interpolate aerodynamic loads onto structural grid</span>
        <span class="n">P_a</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">P_a</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPax_dr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeror</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeroPx</span> <span class="o">=</span> <span class="n">akima_interp_with_derivs</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_r&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_Px&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
        <span class="n">P_a</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPay_dr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeror</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeroPy</span> <span class="o">=</span> <span class="n">akima_interp_with_derivs</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_r&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_Py&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
        <span class="n">P_a</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPaz_dr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeror</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeroPz</span> <span class="o">=</span> <span class="n">akima_interp_with_derivs</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_r&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_Pz&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>


        <span class="c1"># --- weight loads ---</span>

        <span class="c1"># yaw c.s.</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">gravity</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">P_w</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">yawToHub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tilt</span><span class="p">)</span><span class="o">.</span><span class="n">hubToAzimuth</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_azimuth&#39;</span><span class="p">])</span>\
            <span class="o">.</span><span class="n">azimuthToBlade</span><span class="p">(</span><span class="n">totalCone</span><span class="p">)</span>


        <span class="c1"># --- centrifugal loads ---</span>

        <span class="c1"># azimuthal c.s.</span>
        <span class="n">Omega</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_Omega&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">RPM2RS</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">z_az</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">P_c</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">azimuthToBlade</span><span class="p">(</span><span class="n">totalCone</span><span class="p">)</span>


        <span class="c1"># --- total loads ---</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">P_a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_w</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_c</span>

        <span class="c1"># rotate to airfoil c.s.</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_pitch&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">bladeToAirfoil</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Px_af</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Py_af</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pz_af</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">z</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Px_af</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Py_af</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pz_af</span>

    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;aeroloads_r&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Px&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Py&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Omega&#39;</span><span class="p">,</span>
            <span class="s1">&#39;aeroloads_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_azimuth&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;rhoA&#39;</span><span class="p">,</span> <span class="s1">&#39;z_az&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;Pz_af&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="n">dPwx</span><span class="p">,</span> <span class="n">dPwy</span><span class="p">,</span> <span class="n">dPwz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_w</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_w</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_w</span><span class="o">.</span><span class="n">dz</span>
        <span class="n">dPcx</span><span class="p">,</span> <span class="n">dPcy</span><span class="p">,</span> <span class="n">dPcz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_c</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_c</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_c</span><span class="o">.</span><span class="n">dz</span>
        <span class="n">dPx</span><span class="p">,</span> <span class="n">dPy</span><span class="p">,</span> <span class="n">dPz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span>
        <span class="n">Omega</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_Omega&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">RPM2RS</span>
        <span class="n">z_az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_az</span>


        <span class="n">dPx_dOmega</span> <span class="o">=</span> <span class="n">dPcx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">z_az</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">Omega</span><span class="o">*</span><span class="n">RPM2RS</span>
        <span class="n">dPy_dOmega</span> <span class="o">=</span> <span class="n">dPcy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">z_az</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">Omega</span><span class="o">*</span><span class="n">RPM2RS</span>
        <span class="n">dPz_dOmega</span> <span class="o">=</span> <span class="n">dPcz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">z_az</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">Omega</span><span class="o">*</span><span class="n">RPM2RS</span>

        <span class="n">dPx_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_dr</span><span class="p">)</span>
        <span class="n">dPy_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_dr</span><span class="p">)</span>
        <span class="n">dPz_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_dr</span><span class="p">)</span>

        <span class="n">dPx_dprecone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPwx</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPcx</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">])</span>
        <span class="n">dPy_dprecone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPwy</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPcy</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">])</span>
        <span class="n">dPz_dprecone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPwz</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPcz</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">])</span>

        <span class="n">dPx_dzaz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPcx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dPy_dzaz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPcy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dPz_dzaz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPcz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">dPx_drhoA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="o">-</span><span class="n">dPwx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">gravity</span> <span class="o">+</span> <span class="n">dPcx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">z_az</span><span class="p">)</span>
        <span class="n">dPy_drhoA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="o">-</span><span class="n">dPwy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">gravity</span> <span class="o">+</span> <span class="n">dPcy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">z_az</span><span class="p">)</span>
        <span class="n">dPz_drhoA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="o">-</span><span class="n">dPwz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">gravity</span> <span class="o">+</span> <span class="n">dPcz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">z_az</span><span class="p">)</span>

        <span class="n">dPxaf_daeror</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeror</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeror</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeror</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPyaf_daeror</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeror</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeror</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeror</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPzaf_daeror</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeror</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeror</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeror</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPxaf_dPxaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeroPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPxaf_dPyaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeroPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPxaf_dPzaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeroPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPyaf_dPxaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeroPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPyaf_dPyaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeroPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPyaf_dPzaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeroPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPzaf_dPxaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeroPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPzaf_dPyaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeroPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPzaf_dPzaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeroPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPxaf_dOmega</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dOmega</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dOmega</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dOmega</span>
        <span class="n">dPyaf_dOmega</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dOmega</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dOmega</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dOmega</span>
        <span class="n">dPzaf_dOmega</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dOmega</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dOmega</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dOmega</span>

        <span class="n">dPxaf_dpitch</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dtheta&#39;</span><span class="p">]</span>
        <span class="n">dPyaf_dpitch</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dtheta&#39;</span><span class="p">]</span>
        <span class="n">dPzaf_dpitch</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dtheta&#39;</span><span class="p">]</span>

        <span class="n">dPxaf_dazimuth</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwx</span><span class="p">[</span><span class="s1">&#39;dazimuth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwy</span><span class="p">[</span><span class="s1">&#39;dazimuth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwz</span><span class="p">[</span><span class="s1">&#39;dazimuth&#39;</span><span class="p">]</span>
        <span class="n">dPyaf_dazimuth</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwx</span><span class="p">[</span><span class="s1">&#39;dazimuth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwy</span><span class="p">[</span><span class="s1">&#39;dazimuth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwz</span><span class="p">[</span><span class="s1">&#39;dazimuth&#39;</span><span class="p">]</span>
        <span class="n">dPzaf_dazimuth</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwx</span><span class="p">[</span><span class="s1">&#39;dazimuth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwy</span><span class="p">[</span><span class="s1">&#39;dazimuth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwz</span><span class="p">[</span><span class="s1">&#39;dazimuth&#39;</span><span class="p">]</span>

        <span class="n">dPxaf_dr</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dr</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dr</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dr</span>
        <span class="n">dPyaf_dr</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dr</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dr</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dr</span>
        <span class="n">dPzaf_dr</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dr</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dr</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dr</span>

        <span class="n">dPxaf_dtheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dtheta&#39;</span><span class="p">])</span>
        <span class="n">dPyaf_dtheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dtheta&#39;</span><span class="p">])</span>
        <span class="n">dPzaf_dtheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dtheta&#39;</span><span class="p">])</span>

        <span class="n">dPxaf_dtilt</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwx</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwy</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwz</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">]</span>
        <span class="n">dPyaf_dtilt</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwx</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwy</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwz</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">]</span>
        <span class="n">dPzaf_dtilt</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwx</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwy</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwz</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">]</span>

        <span class="n">dPxaf_dprecone</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dprecone</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dprecone</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dprecone</span>
        <span class="n">dPyaf_dprecone</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dprecone</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dprecone</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dprecone</span>
        <span class="n">dPzaf_dprecone</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dprecone</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dprecone</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dprecone</span>

        <span class="n">dPxaf_drhoA</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_drhoA</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_drhoA</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_drhoA</span>
        <span class="n">dPyaf_drhoA</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_drhoA</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_drhoA</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_drhoA</span>
        <span class="n">dPzaf_drhoA</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_drhoA</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_drhoA</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_drhoA</span>

        <span class="n">dPxaf_dzaz</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dzaz</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dzaz</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dzaz</span>
        <span class="n">dPyaf_dzaz</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dzaz</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dzaz</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dzaz</span>
        <span class="n">dPzaf_dzaz</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dzaz</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dzaz</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dzaz</span>

        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_daeror</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Px&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_dPxaero</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Py&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_dPyaero</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Pz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_dPzaero</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Omega&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_dOmega</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_pitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_dpitch</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_azimuth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_dazimuth</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_dr</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_dtheta</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_dtilt</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;totalCone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_dprecone</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;rhoA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_drhoA</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;z_az&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPxaf_dzaz</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_daeror</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Px&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_dPxaero</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Py&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_dPyaero</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Pz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_dPzaero</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Omega&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_dOmega</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_pitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_dpitch</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_azimuth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_dazimuth</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_dr</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_dtheta</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_dtilt</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;totalCone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_dprecone</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;rhoA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_drhoA</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;z_az&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPyaf_dzaz</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_daeror</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Px&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_dPxaero</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Py&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_dPyaero</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Pz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_dPzaero</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Omega&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_dOmega</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_pitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_dpitch</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_azimuth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_dazimuth</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_dr</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_dtheta</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_dtilt</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;totalCone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_dprecone</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;rhoA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_drhoA</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;z_az&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPzaf_dzaz</span>

        <span class="k">return</span> <span class="n">J</span></div>



<div class="viewcode-block" id="TipDeflection"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.TipDeflection">[docs]</a><span class="k">class</span> <span class="nc">TipDeflection</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TipDeflection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflection at tip in airfoil x-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflection at tip in airfoil y-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflection at tip in airfoil z-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;twist at tip section&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;pitch&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;blade pitch angle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;azimuth&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;azimuth angle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;tilt angle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;totalConeTip&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total coning angle including precone and curvature&#39;</span><span class="p">)</span>

        <span class="c1"># parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;dynamicFactor&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;a dynamic amplification factor to adjust the static deflection calculation&#39;</span><span class="p">)</span> <span class="c1">#, pass_by_obj=True)</span>

        <span class="c1"># outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflection at tip in yaw x-direction&#39;</span><span class="p">)</span>

	<span class="c1">#self.deriv_options[&#39;form&#39;] = &#39;central&#39;</span>
        <span class="c1">#self.deriv_options[&#39;check_form&#39;] = &#39;central&#39;</span>
	<span class="c1">#self.deriv_options[&#39;step_calc&#39;] = &#39;relative&#39;</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dz</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tilt</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalConeTip</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;totalConeTip&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;dynamicFactor&#39;</span><span class="p">]</span>

        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>

        <span class="n">dr</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">airfoilToBlade</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">.</span><span class="n">bladeToAzimuth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalConeTip</span><span class="p">)</span><span class="o">.</span><span class="n">azimuthToHub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span><span class="p">)</span><span class="o">.</span><span class="n">hubToYaw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tilt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tip_deflection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">x</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip_deflection</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;azimuth&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;totalConeTip&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span>
        <span class="n">dtheta</span> <span class="o">=</span> <span class="n">dpitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dtheta&#39;</span><span class="p">]</span>
        <span class="n">dazimuth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dazimuth&#39;</span><span class="p">]</span>
        <span class="n">dtilt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">]</span>
        <span class="n">dtotalConeTip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dx</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dy</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,</span> <span class="s1">&#39;dz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dz</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtheta</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,</span> <span class="s1">&#39;pitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpitch</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,</span> <span class="s1">&#39;azimuth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dazimuth</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtilt</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,</span> <span class="s1">&#39;totalConeTip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtotalConeTip</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,</span> <span class="s1">&#39;dynamicFactor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">J</span></div>

<span class="c1"># class ReverseTipDeflection(Component):</span>
<span class="c1">#     def __init__(self):</span>
<span class="c1">#         super(ReverseTipDeflection, self).__init__()</span>
<span class="c1">#         # variables</span>
<span class="c1">#         self.add_param(&#39;dx&#39;, val=0.0) # deflection at tip in airfoil c.s.</span>
<span class="c1">#         self.add_param(&#39;dy&#39;, val=0.0)</span>
<span class="c1">#         self.add_param(&#39;dz&#39;, val=0.0)</span>
<span class="c1">#         self.add_param(&#39;theta&#39;, val=0.0)</span>
<span class="c1">#         self.add_param(&#39;pitch&#39;, val=0.0)</span>
<span class="c1">#         self.add_param(&#39;azimuth&#39;, val=0.0)</span>
<span class="c1">#         self.add_param(&#39;tilt&#39;, val=0.0)</span>
<span class="c1">#         self.add_param(&#39;precone&#39;, val=0.0)</span>
<span class="c1">#         self.add_param(&#39;yawW&#39;, val=0.0)</span>
<span class="c1">#         self.add_param(&#39;dynamicFactor&#39;, val=1.2)</span>
<span class="c1">#         self.add_output(&#39;tip_deflection&#39;, val=0.0)</span>
<span class="c1">#</span>
<span class="c1">#     def solve_nonlinear(self, params, unknowns, resids):</span>
<span class="c1">#</span>
<span class="c1">#         theta = params[&#39;theta&#39;] + params[&#39;pitch&#39;]</span>
<span class="c1">#</span>
<span class="c1">#         dr = DirectionVector(params[&#39;dx&#39;], params[&#39;dy&#39;], params[&#39;dz&#39;])</span>
<span class="c1">#         self.delta = dr.airfoilToBlade(theta).bladeToAzimuth(params[&#39;precone&#39;]) \</span>
<span class="c1">#             .azimuthToHub(params[&#39;azimuth&#39;]).hubToYaw(params[&#39;tilt&#39;]).yawToWind(180.0-params[&#39;yawW&#39;])</span>
<span class="c1">#</span>
<span class="c1">#         unknowns[&#39;tip_deflection&#39;] = params[&#39;dynamicFactor&#39;] * self.delta.x</span>

<div class="viewcode-block" id="BladeDeflection"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.BladeDeflection">[docs]</a><span class="k">class</span> <span class="nc">BladeDeflection</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BladeDeflection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflections in airfoil x-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflections in airfoil y-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;deflections in airfoil z-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;pitch&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;blade pitch angle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;structural twist&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;r_in0&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NINPUT</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Spline control points for inputs&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Rhub0&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;hub radius&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;r_pts0&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;undeflected radial locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;precurve0&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;undeflected precurve locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;bladeLength0&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;original blade length (only an actual length if no curvature)&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;adjustment to blade length to account for curvature from loading&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NINPUT</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;adjustment to precurve to account for curvature from loading&#39;</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dz</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_in0</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;r_in0&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rhub0</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Rhub0&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;r_pts0&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;precurve0&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bladeLength0&#39;</span><span class="p">]</span>


        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>

        <span class="n">dr</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">airfoilToBlade</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">precurve_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">x</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">length0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rhub0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rhub0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">precurve_out</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">precurve_out</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                                           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shortening</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delta_bladeLength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortening</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># TODO: linearly interpolation is not C1 continuous.  it should work OK for now, but is not ideal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_precurve_sub</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_drsubpc0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_drstr0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_ddeltax</span> <span class="o">=</span> \
            <span class="n">interp_with_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_in0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_bladeLength</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_precurve_sub</span>

    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="s1">&#39;pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;r_in0&#39;</span><span class="p">,</span> <span class="s1">&#39;Rhub0&#39;</span><span class="p">,</span>
            <span class="s1">&#39;r_pts0&#39;</span><span class="p">,</span> <span class="s1">&#39;precurve0&#39;</span><span class="p">,</span> <span class="s1">&#39;bladeLength0&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">ddeltax_ddx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span>
        <span class="n">ddeltax_ddy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span>
        <span class="n">ddeltax_ddz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span>
        <span class="n">ddeltax_dtheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dtheta&#39;</span><span class="p">]</span>
        <span class="n">ddeltax_dthetastr</span> <span class="o">=</span> <span class="n">ddeltax_dtheta</span>
        <span class="n">ddeltax_dpitch</span> <span class="o">=</span> <span class="n">ddeltax_dtheta</span>

        <span class="n">dl0_drhub0</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">dl_drhub0</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">dl0_dprecurvestr0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">dl_dprecurvestr0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">dl0_drstr0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">dl_drstr0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="n">precurve_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">x</span>


        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">sm0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">precurve_out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_out</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">sp0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">precurve_out</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_out</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">dl0_dprecurvestr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">sm0</span> \
                <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">sp0</span>
            <span class="n">dl_dprecurvestr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">precurve_out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_out</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">sm</span> \
                <span class="o">-</span> <span class="p">(</span><span class="n">precurve_out</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_out</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">sp</span>
            <span class="n">dl0_drstr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">sm0</span> \
                <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">sp0</span>
            <span class="n">dl_drstr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">sm</span> \
                <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">sp</span>

        <span class="n">sfirst0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">sfirst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">precurve_out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_out</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">slast0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">slast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">precurve_out</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_out</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dl0_dprecurvestr0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">sfirst0</span>
        <span class="n">dl0_dprecurvestr0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">slast0</span>
        <span class="n">dl_dprecurvestr0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">precurve_out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_out</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">sfirst</span>
        <span class="n">dl_dprecurvestr0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">precurve_out</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_out</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">slast</span>
        <span class="n">dl0_drstr0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">sfirst0</span>
        <span class="n">dl0_drstr0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">slast0</span>
        <span class="n">dl_drstr0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">sfirst</span>
        <span class="n">dl_drstr0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">slast</span>

        <span class="n">dl_ddeltax</span> <span class="o">=</span> <span class="n">dl_dprecurvestr0</span>
        <span class="n">dl_ddx</span> <span class="o">=</span> <span class="n">dl_ddeltax</span> <span class="o">*</span> <span class="n">ddeltax_ddx</span>
        <span class="n">dl_ddy</span> <span class="o">=</span> <span class="n">dl_ddeltax</span> <span class="o">*</span> <span class="n">ddeltax_ddy</span>
        <span class="n">dl_ddz</span> <span class="o">=</span> <span class="n">dl_ddeltax</span> <span class="o">*</span> <span class="n">ddeltax_ddz</span>
        <span class="n">dl_dthetastr</span> <span class="o">=</span> <span class="n">dl_ddeltax</span> <span class="o">*</span> <span class="n">ddeltax_dthetastr</span>
        <span class="n">dl_dpitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dl_ddeltax</span><span class="p">,</span> <span class="n">ddeltax_dpitch</span><span class="p">)</span>

        <span class="n">dshort_dl</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">length0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">dshort_dl0</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="n">dshort_drhub0</span> <span class="o">=</span> <span class="n">dshort_dl0</span><span class="o">*</span><span class="n">dl0_drhub0</span> <span class="o">+</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_drhub0</span>
        <span class="n">dshort_dprecurvestr0</span> <span class="o">=</span> <span class="n">dshort_dl0</span><span class="o">*</span><span class="n">dl0_dprecurvestr0</span> <span class="o">+</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_dprecurvestr0</span>
        <span class="n">dshort_drstr0</span> <span class="o">=</span> <span class="n">dshort_dl0</span><span class="o">*</span><span class="n">dl0_drstr0</span> <span class="o">+</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_drstr0</span>
        <span class="n">dshort_ddx</span> <span class="o">=</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_ddx</span>
        <span class="n">dshort_ddy</span> <span class="o">=</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_ddy</span>
        <span class="n">dshort_ddz</span> <span class="o">=</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_ddz</span>
        <span class="n">dshort_dthetastr</span> <span class="o">=</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_dthetastr</span>
        <span class="n">dshort_dpitch</span> <span class="o">=</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_dpitch</span>

        <span class="n">dbl_dbl0</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortening</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">dbl_drhub0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_drhub0</span>
        <span class="n">dbl_dprecurvestr0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_dprecurvestr0</span>
        <span class="n">dbl_drstr0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_drstr0</span>
        <span class="n">dbl_ddx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_ddx</span>
        <span class="n">dbl_ddy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_ddy</span>
        <span class="n">dbl_ddz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_ddz</span>
        <span class="n">dbl_dthetastr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_dthetastr</span>
        <span class="n">dbl_dpitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_dpitch</span>

        <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_in0</span><span class="p">)</span>
        <span class="n">dpcs_ddx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_ddeltax</span><span class="o">*</span><span class="n">ddeltax_ddx</span>
        <span class="n">dpcs_ddy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_ddeltax</span><span class="o">*</span><span class="n">ddeltax_ddy</span>
        <span class="n">dpcs_ddz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_ddeltax</span><span class="o">*</span><span class="n">ddeltax_ddz</span>
        <span class="n">dpcs_dpitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpcs_ddeltax</span><span class="p">,</span> <span class="n">ddeltax_dpitch</span><span class="p">)</span>
        <span class="n">dpcs_dthetastr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_ddeltax</span><span class="o">*</span><span class="n">ddeltax_dthetastr</span>

        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dbl_ddx</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbl_ddx</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dbl_ddy</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbl_ddy</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;dz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dbl_ddz</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbl_ddz</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;pitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbl_dpitch</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dbl_dthetastr</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbl_dthetastr</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;r_in0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;Rhub0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbl_drhub0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;r_pts0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dbl_drstr0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbl_drstr0</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;precurve0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dbl_dprecurvestr0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbl_dprecurvestr0</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;bladeLength0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbl_dbl0</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpcs_ddx</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpcs_ddy</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;dz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpcs_ddz</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;pitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpcs_dpitch</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpcs_dthetastr</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;r_in0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_drsubpc0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;Rhub0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;r_pts0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_drstr0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;precurve0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;bladeLength0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">J</span></div>


<div class="viewcode-block" id="RootMoment"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.RootMoment">[docs]</a><span class="k">class</span> <span class="nc">RootMoment</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;blade root bending moment&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RootMoment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;aeroloads_r&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;radial positions along blade going toward tip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;aeroloads_Px&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed loads in blade-aligned x-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;aeroloads_Py&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed loads in blade-aligned y-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;aeroloads_Pz&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distributed loads in blade-aligned z-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;r_pts&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;totalCone&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total cone angle from precone and curvature&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;x_az&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;location of blade in azimuth x-coordinate system&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;y_az&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;location of blade in azimuth y-coordinate system&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;z_az&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;location of blade in azimuth z-coordinate system&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;cumulative path length along blade&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total magnitude of bending moment at root of blade&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mxyz&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Fxyz&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s.&#39;</span><span class="p">)</span>

        <span class="c1">#self.deriv_options[&#39;type&#39;] = &#39;fd&#39;</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>
        <span class="c1">#self.deriv_options[&#39;step_size&#39;] = 1e-5</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">r_pts</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;r_pts&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalCone</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;totalCone&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_az</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;x_az&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_az</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;y_az&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_az</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;z_az&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span>

        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pts</span>
        <span class="n">x_az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_az</span>
        <span class="n">y_az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_az</span>
        <span class="n">z_az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_az</span>


        <span class="c1"># aL = self.aeroloads</span>
        <span class="c1"># TODO: linearly interpolation is not C1 continuous.  it should work OK for now, but is not ideal</span>
        <span class="n">Px</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPx_dr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalPx</span> <span class="o">=</span> <span class="n">interp_with_deriv</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_r&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_Px&#39;</span><span class="p">])</span>
        <span class="n">Py</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPy_dr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalPy</span> <span class="o">=</span> <span class="n">interp_with_deriv</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_r&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_Py&#39;</span><span class="p">])</span>
        <span class="n">Pz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPz_dr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalPz</span> <span class="o">=</span> <span class="n">interp_with_deriv</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_r&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aeroloads_Pz&#39;</span><span class="p">])</span>

        <span class="c1"># print &#39;al.Pz: &#39;, aL.Pz #check=0</span>

        <span class="n">Fx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Px</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">])</span>
        <span class="n">Fy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Py</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">])</span>
        <span class="n">Fz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Pz</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">])</span>

        <span class="c1"># loads in azimuthal c.s.</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="n">Px</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span><span class="p">)</span><span class="o">.</span><span class="n">bladeToAzimuth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalCone</span><span class="p">)</span>

        <span class="c1"># distributed bending load in azimuth coordinate ysstem</span>
        <span class="n">az</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="n">x_az</span><span class="p">,</span> <span class="n">y_az</span><span class="p">,</span> <span class="n">z_az</span><span class="p">)</span>
        <span class="n">Mp</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

        <span class="c1"># integrate</span>
        <span class="n">Mx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Mp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="n">My</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Mp</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="n">Mz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Mp</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

        <span class="c1"># get total magnitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Mx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">My</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Mz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">=</span> <span class="n">az</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mp</span> <span class="o">=</span> <span class="n">Mp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mx</span> <span class="o">=</span> <span class="n">Mx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">My</span> <span class="o">=</span> <span class="n">My</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span> <span class="o">=</span> <span class="n">Mz</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Mxyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Mx</span><span class="p">,</span> <span class="n">My</span><span class="p">,</span> <span class="n">Mz</span><span class="p">])</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Fxyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Fx</span><span class="p">,</span><span class="n">Fy</span><span class="p">,</span><span class="n">Fz</span><span class="p">])</span>
        <span class="c1"># print &#39;Forces: &#39;, unknowns[&#39;Fxyz&#39;]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;r_pts&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_r&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Px&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Py&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;totalCone&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;x_az&#39;</span><span class="p">,</span> <span class="s1">&#39;y_az&#39;</span><span class="p">,</span> <span class="s1">&#39;z_az&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="c1"># dx_dr = -sind(self.precone)</span>
        <span class="c1"># dz_dr = cosd(self.precone)</span>

        <span class="c1"># dx_dprecone = -self.r*cosd(self.precone)*np.pi/180.0</span>
        <span class="c1"># dz_dprecone = -self.r*sind(self.precone)*np.pi/180.0</span>

        <span class="n">dPx_dr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPy_dr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPz_dr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPx_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPy_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPz_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPx_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPx_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPx_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPy_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPy_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPy_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPz_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPz_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPz_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


        <span class="c1"># dazx_dr = np.diag(self.az.dx[&#39;dx&#39;]*dx_dr + self.az.dx[&#39;dz&#39;]*dz_dr)</span>
        <span class="c1"># dazy_dr = np.diag(self.az.dy[&#39;dx&#39;]*dx_dr + self.az.dy[&#39;dz&#39;]*dz_dr)</span>
        <span class="c1"># dazz_dr = np.diag(self.az.dz[&#39;dx&#39;]*dx_dr + self.az.dz[&#39;dz&#39;]*dz_dr)</span>

        <span class="c1"># dazx_dprecone = (self.az.dx[&#39;dx&#39;]*dx_dprecone.T + self.az.dx[&#39;dz&#39;]*dz_dprecone.T).T</span>
        <span class="c1"># dazy_dprecone = (self.az.dy[&#39;dx&#39;]*dx_dprecone.T + self.az.dy[&#39;dz&#39;]*dz_dprecone.T).T</span>
        <span class="c1"># dazz_dprecone = (self.az.dz[&#39;dx&#39;]*dx_dprecone.T + self.az.dz[&#39;dz&#39;]*dz_dprecone.T).T</span>

        <span class="n">dMpx</span><span class="p">,</span> <span class="n">dMpy</span><span class="p">,</span> <span class="n">dMpz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="o">.</span><span class="n">cross_deriv_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">namea</span><span class="o">=</span><span class="s1">&#39;az&#39;</span><span class="p">,</span> <span class="n">nameb</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>

        <span class="n">dMpx_dr</span> <span class="o">=</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dr</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpy_dr</span> <span class="o">=</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dr</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpz_dr</span> <span class="o">=</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dr</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dMpx_dtotalcone</span> <span class="o">=</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpy_dtotalcone</span> <span class="o">=</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpz_dtotalcone</span> <span class="o">=</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dMpx_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpy_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpz_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dMpx_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPx</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPx</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpy_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPx</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPx</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpz_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPx</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPx</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dMpx_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPy</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPy</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpy_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPy</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPy</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpz_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPy</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPy</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dMpx_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPz</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPz</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpy_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPz</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPz</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpz_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPz</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPz</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dMx_dMpx</span><span class="p">,</span> <span class="n">dMx_ds</span> <span class="o">=</span> <span class="n">trapz_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="n">dMy_dMpy</span><span class="p">,</span> <span class="n">dMy_ds</span> <span class="o">=</span> <span class="n">trapz_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mp</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="n">dMz_dMpz</span><span class="p">,</span> <span class="n">dMz_ds</span> <span class="o">=</span> <span class="n">trapz_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mp</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

        <span class="n">dMx_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMx_dMpx</span><span class="p">,</span> <span class="n">dMpx_dr</span><span class="p">)</span>
        <span class="n">dMy_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMy_dMpy</span><span class="p">,</span> <span class="n">dMpy_dr</span><span class="p">)</span>
        <span class="n">dMz_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMz_dMpz</span><span class="p">,</span> <span class="n">dMpz_dr</span><span class="p">)</span>

        <span class="n">dMx_dalr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMx_dMpx</span><span class="p">,</span> <span class="n">dMpx_dalr</span><span class="p">)</span>
        <span class="n">dMy_dalr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMy_dMpy</span><span class="p">,</span> <span class="n">dMpy_dalr</span><span class="p">)</span>
        <span class="n">dMz_dalr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMz_dMpz</span><span class="p">,</span> <span class="n">dMpz_dalr</span><span class="p">)</span>

        <span class="n">dMx_dalPx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMx_dMpx</span><span class="p">,</span> <span class="n">dMpx_dalPx</span><span class="p">)</span>
        <span class="n">dMy_dalPx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMy_dMpy</span><span class="p">,</span> <span class="n">dMpy_dalPx</span><span class="p">)</span>
        <span class="n">dMz_dalPx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMz_dMpz</span><span class="p">,</span> <span class="n">dMpz_dalPx</span><span class="p">)</span>

        <span class="n">dMx_dalPy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMx_dMpx</span><span class="p">,</span> <span class="n">dMpx_dalPy</span><span class="p">)</span>
        <span class="n">dMy_dalPy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMy_dMpy</span><span class="p">,</span> <span class="n">dMpy_dalPy</span><span class="p">)</span>
        <span class="n">dMz_dalPy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMz_dMpz</span><span class="p">,</span> <span class="n">dMpz_dalPy</span><span class="p">)</span>

        <span class="n">dMx_dalPz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMx_dMpx</span><span class="p">,</span> <span class="n">dMpx_dalPz</span><span class="p">)</span>
        <span class="n">dMy_dalPz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMy_dMpy</span><span class="p">,</span> <span class="n">dMpy_dalPz</span><span class="p">)</span>
        <span class="n">dMz_dalPz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMz_dMpz</span><span class="p">,</span> <span class="n">dMpz_dalPz</span><span class="p">)</span>

        <span class="n">dMx_dtotalcone</span> <span class="o">=</span> <span class="n">dMx_dMpx</span> <span class="o">*</span> <span class="n">dMpx_dtotalcone</span>
        <span class="n">dMy_dtotalcone</span> <span class="o">=</span> <span class="n">dMy_dMpy</span> <span class="o">*</span> <span class="n">dMpy_dtotalcone</span>
        <span class="n">dMz_dtotalcone</span> <span class="o">=</span> <span class="n">dMz_dMpz</span> <span class="o">*</span> <span class="n">dMpz_dtotalcone</span>

        <span class="n">dMx_dazx</span> <span class="o">=</span> <span class="n">dMx_dMpx</span> <span class="o">*</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dazx&#39;</span><span class="p">]</span>
        <span class="n">dMx_dazy</span> <span class="o">=</span> <span class="n">dMx_dMpx</span> <span class="o">*</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dazy&#39;</span><span class="p">]</span>
        <span class="n">dMx_dazz</span> <span class="o">=</span> <span class="n">dMx_dMpx</span> <span class="o">*</span> <span class="n">dMpx</span><span class="p">[</span><span class="s1">&#39;dazz&#39;</span><span class="p">]</span>

        <span class="n">dMy_dazx</span> <span class="o">=</span> <span class="n">dMy_dMpy</span> <span class="o">*</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dazx&#39;</span><span class="p">]</span>
        <span class="n">dMy_dazy</span> <span class="o">=</span> <span class="n">dMy_dMpy</span> <span class="o">*</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dazy&#39;</span><span class="p">]</span>
        <span class="n">dMy_dazz</span> <span class="o">=</span> <span class="n">dMy_dMpy</span> <span class="o">*</span> <span class="n">dMpy</span><span class="p">[</span><span class="s1">&#39;dazz&#39;</span><span class="p">]</span>

        <span class="n">dMz_dazx</span> <span class="o">=</span> <span class="n">dMz_dMpz</span> <span class="o">*</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dazx&#39;</span><span class="p">]</span>
        <span class="n">dMz_dazy</span> <span class="o">=</span> <span class="n">dMz_dMpz</span> <span class="o">*</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dazy&#39;</span><span class="p">]</span>
        <span class="n">dMz_dazz</span> <span class="o">=</span> <span class="n">dMz_dMpz</span> <span class="o">*</span> <span class="n">dMpz</span><span class="p">[</span><span class="s1">&#39;dazz&#39;</span><span class="p">]</span>

        <span class="n">drbm_dr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dr</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dalr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dalr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dalr</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dalPx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dalPx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dalPx</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dalPy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dalPy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dalPy</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dalPz</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dalPz</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dalPz</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dtotalcone</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dtotalcone</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dtotalcone</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dtotalcone</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dazx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dazx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dazx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dazx</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dazy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dazy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dazy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dazy</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dazz</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dazz</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dazz</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dazz</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_ds</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_ds</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_ds</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_ds</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>


        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;r_pts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">drbm_dr</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">drbm_dr</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">drbm_dalr</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">drbm_dalr</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Px&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">drbm_dalPx</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">drbm_dalPx</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Py&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">drbm_dalPy</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">drbm_dalPy</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroloads_Pz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">drbm_dalPz</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">drbm_dalPz</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;totalCone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">drbm_dtotalcone</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">drbm_dtotalcone</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;x_az&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">drbm_dazx</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">drbm_dazx</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;y_az&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">drbm_dazy</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">drbm_dazy</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;z_az&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">drbm_dazz</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">drbm_dazz</span><span class="p">)))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">drbm_ds</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">drbm_ds</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">J</span></div>



<span class="k">class</span> <span class="nc">MassProperties</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MassProperties</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;blade_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass of one blade&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;blade_moment_of_inertia&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass moment of inertia of blade about hub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rotor tilt angle (used to translate moments of inertia from hub to yaw c.s.&#39;</span><span class="p">)</span>

        <span class="c1"># parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;nBlades&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;number of blades&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;mass_all_blades&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass of all blades&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;I_all_blades&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass moments of inertia of all blades in yaw c.s. order:Ixx, Iyy, Izz, Ixy, Ixz, Iyz&#39;</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>


    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">blade_mass</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;blade_mass&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blade_moment_of_inertia</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;blade_moment_of_inertia&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tilt</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nBlades&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mass_all_blades</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">blade_mass</span>

        <span class="n">Ibeam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">blade_moment_of_inertia</span>

        <span class="n">Ixx</span> <span class="o">=</span> <span class="n">Ibeam</span>
        <span class="n">Iyy</span> <span class="o">=</span> <span class="n">Ibeam</span><span class="o">/</span><span class="mf">2.0</span>  <span class="c1"># azimuthal average for 2 blades, exact for 3+</span>
        <span class="n">Izz</span> <span class="o">=</span> <span class="n">Ibeam</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">Ixy</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">Ixz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">Iyz</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># azimuthal average for 2 blades, exact for 3+</span>

        <span class="c1"># rotate to yaw c.s.</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="n">Ixx</span><span class="p">,</span> <span class="n">Iyy</span><span class="p">,</span> <span class="n">Izz</span><span class="p">)</span><span class="o">.</span><span class="n">hubToYaw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tilt</span><span class="p">)</span>  <span class="c1"># because off-diagonal components are all zero</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">I_all_blades</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">I</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">I</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">I</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">Ixy</span><span class="p">,</span> <span class="n">Ixz</span><span class="p">,</span> <span class="n">Iyz</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ivec</span> <span class="o">=</span> <span class="n">I</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;mass_all_blades&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_all_blades</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;I_all_blades&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I_all_blades</span>

    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;blade_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_moment_of_inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;mass_all_blades&#39;</span><span class="p">,</span> <span class="s1">&#39;I_all_blades&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ivec</span>

        <span class="n">dIx_dmoi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span><span class="o">*</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">dIy_dmoi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span><span class="o">*</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">dIz_dmoi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span><span class="o">*</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;mass_all_blades&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;mass_all_blades&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_moment_of_inertia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;mass_all_blades&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;I_all_blades&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;I_all_blades&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_moment_of_inertia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dIx_dmoi</span><span class="p">,</span> <span class="n">dIy_dmoi</span><span class="p">,</span> <span class="n">dIz_dmoi</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;I_all_blades&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">I</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">],</span>  <span class="n">I</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">],</span>  <span class="n">I</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dtilt&#39;</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">J</span>


<span class="k">class</span> <span class="nc">ExtremeLoads</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExtremeLoads</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">((</span><span class="mi">2</span><span class="p">,)),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rotor thrust, index 0 is at worst-case, index 1 feathered&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">((</span><span class="mi">2</span><span class="p">,)),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rotor torque, index 0 is at worst-case, index 1 feathered&#39;</span><span class="p">)</span>

        <span class="c1"># parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;nBlades&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;number of blades&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;T_extreme&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rotor thrust at survival wind condition&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Q_extreme&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rotor torque at survival wind condition&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nBlades&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_extreme</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q_extreme</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;T_extreme&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_extreme</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Q_extreme&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;T_extreme&#39;</span><span class="p">,</span> <span class="s1">&#39;Q_extreme&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nBlades&#39;</span><span class="p">])</span>
        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;T_extreme&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="o">/</span><span class="n">n</span><span class="p">],</span> <span class="p">[(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">]]),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="c1"># J[&#39;Q_extreme&#39;, &#39;Q&#39;] = np.reshape(np.array([1.0/n, (n-1)/n]), (1, 2))</span>

        <span class="k">return</span> <span class="n">J</span>




<div class="viewcode-block" id="GustETM"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.GustETM">[docs]</a><span class="k">class</span> <span class="nc">GustETM</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GustETM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;V_mean&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;IEC average wind speed for turbine class&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;V_hub&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;hub height wind speed&#39;</span><span class="p">)</span>

        <span class="c1"># parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;turbulence_class&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">TURBULENCE_CLASS</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;IEC turbulence class&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;number of standard deviations for strength of gust&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;V_gust&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;gust wind speed&#39;</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_mean</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;V_mean&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_hub</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;V_hub&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_class</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;turbulence_class&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_class</span> <span class="o">==</span> <span class="n">TURBULENCE_CLASS</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]:</span>
            <span class="n">Iref</span> <span class="o">=</span> <span class="mf">0.16</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_class</span> <span class="o">==</span> <span class="n">TURBULENCE_CLASS</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]:</span>
            <span class="n">Iref</span> <span class="o">=</span> <span class="mf">0.14</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_class</span> <span class="o">==</span> <span class="n">TURBULENCE_CLASS</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]:</span>
            <span class="n">Iref</span> <span class="o">=</span> <span class="mf">0.12</span>

        <span class="n">c</span> <span class="o">=</span> <span class="mf">2.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">Iref</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.072</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V_mean</span><span class="o">/</span><span class="n">c</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V_hub</span><span class="o">/</span><span class="n">c</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_gust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_hub</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Iref</span> <span class="o">=</span> <span class="n">Iref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;V_gust&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_gust</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;V_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;V_hub&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;V_gust&#39;</span><span class="p">,</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">Iref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Iref</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;V_gust&#39;</span><span class="p">,</span> <span class="s1">&#39;V_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">Iref</span><span class="o">*</span><span class="mf">0.072</span><span class="o">/</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V_hub</span><span class="o">/</span><span class="n">c</span> <span class="o">-</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;V_gust&#39;</span><span class="p">,</span> <span class="s1">&#39;V_hub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">Iref</span><span class="o">*</span><span class="mf">0.072</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V_mean</span><span class="o">/</span><span class="n">c</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">J</span></div>



<div class="viewcode-block" id="SetupPCModVarSpeed"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.SetupPCModVarSpeed">[docs]</a><span class="k">class</span> <span class="nc">SetupPCModVarSpeed</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SetupPCModVarSpeed</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;control_tsr&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;tip-speed ratio in Region 2 (should be optimized externally)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;control_pitch&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;pitch angle in region 2 (and region 3 for fixed pitch machines)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Vrated&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rated wind speed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rotor radius&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Vfactor&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fraction of rated speed at which the deflection is assumed to representative throughout the power curve calculation&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Uhub&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;freestream velocities to run&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Omega&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;rpm&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rotation speeds to run&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;pitch&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;pitch angles to run&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;azimuth&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Vrated</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Vrated&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Vfactor</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Vfactor&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Uhub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vfactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vrated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;control_tsr&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Uhub</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">RS2RPM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;control_pitch&#39;</span><span class="p">]</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Uhub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Uhub</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Omega</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;control_tsr&#39;</span><span class="p">,</span> <span class="s1">&#39;control_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;Vrated&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Uhub&#39;</span><span class="p">,</span> <span class="s1">&#39;Omega&#39;</span><span class="p">,</span> <span class="s1">&#39;pitch&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>

        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Uhub&#39;</span><span class="p">,</span> <span class="s1">&#39;control_tsr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Uhub&#39;</span><span class="p">,</span> <span class="s1">&#39;Vrated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vfactor</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Uhub&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Uhub&#39;</span><span class="p">,</span> <span class="s1">&#39;control_pitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">,</span> <span class="s1">&#39;control_tsr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Uhub</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">RS2RPM</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">,</span> <span class="s1">&#39;Vrated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;control_tsr&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Vfactor</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">RS2RPM</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;control_tsr&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Uhub</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">RS2RPM</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">,</span> <span class="s1">&#39;control_pitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;control_tsr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;Vrated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;control_pitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="k">return</span> <span class="n">J</span></div>


<div class="viewcode-block" id="ConstraintsStructures"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.ConstraintsStructures">[docs]</a><span class="k">class</span> <span class="nc">ConstraintsStructures</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ConstraintsStructures</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;nBlades&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;number of blades&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;1st nF natural frequencies&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;freq_curvefem&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;1st nF natural frequencies&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Omega&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;rpm&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rotation speed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;strainU_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;strainL_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;strainU_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;strainL_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;strain_ult_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;ultimate strain in spar cap&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;strain_ult_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;uptimate strain in trailing-edge panels&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;eps_crit_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;critical strain in spar from panel buckling calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;eps_crit_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;critical strain in trailing-edge panels from panel buckling calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;damageU_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on upper surface in spar cap&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;damageL_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on lower surface in spar cap&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;damageU_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on upper surface in trailing-edge panels&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;damageL_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on lower surface in trailing-edge panels&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor on loads&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_m&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor on materials&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_freq&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;partial safety factor for fatigue&#39;</span><span class="p">)</span>
        

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Pn_margin&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Blade natural frequency (pBeam) relative to blade passing frequency&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;P1_margin&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Blade natural frequency (pBeam) relative to rotor passing frequency&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Pn_margin_cfem&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Blade natural frequency (curvefem) relative to blade passing frequency&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;P1_margin_cfem&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Blade natural frequency (curvefem) relative to rotor passing frequency&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rotor_strain_sparU&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Strain in upper spar relative to ultimate allowable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rotor_strain_sparL&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Strain in lower spar relative to ultimate allowable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rotor_strain_teU&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Strain in upper trailing edge relative to ultimate allowable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rotor_strain_teL&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Strain in lower trailing edge relative to ultimate allowable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rotor_buckling_sparU&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Buckling in upper spar relative to ultimate allowable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rotor_buckling_sparL&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Buckling in lower spar relative to ultimate allowable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rotor_buckling_teU&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Buckling in upper trailing edge relative to ultimate allowable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rotor_buckling_teL&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Buckling in lower trailing edge relative to ultimate allowable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rotor_damage_sparU&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Damage in upper spar relative to ultimate allowable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rotor_damage_sparL&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Damage in lower spar relative to ultimate allowable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rotor_damage_teU&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Damage in upper trailing edge relative to ultimate allowable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rotor_damage_teL&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Damage in lower trailing edge relative to ultimate allowable&#39;</span><span class="p">)</span>

        
    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="c1"># Unpack variables</span>
        <span class="n">omega</span>           <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">60.0</span> <span class="c1">#Hz</span>
        <span class="n">gamma_freq</span>      <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_freq&#39;</span><span class="p">]</span>
        <span class="n">gamma_f</span>         <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span>
        <span class="n">gamma_strain</span>    <span class="o">=</span> <span class="n">gamma_f</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_m&#39;</span><span class="p">]</span>
        <span class="n">strain_ult_spar</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strain_ult_spar&#39;</span><span class="p">]</span>
        <span class="n">strain_ult_te</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strain_ult_te&#39;</span><span class="p">]</span>
        <span class="n">eps_crit_spar</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;eps_crit_spar&#39;</span><span class="p">]</span>
        <span class="n">eps_crit_te</span>     <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;eps_crit_te&#39;</span><span class="p">]</span>
        
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Pn_margin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nBlades&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">omega</span><span class="o">*</span><span class="n">gamma_freq</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;P1_margin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>                  <span class="n">omega</span><span class="o">*</span><span class="n">gamma_freq</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Pn_margin_cfem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nBlades&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">omega</span><span class="o">*</span><span class="n">gamma_freq</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq_curvefem&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;P1_margin_cfem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>                  <span class="n">omega</span><span class="o">*</span><span class="n">gamma_freq</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq_curvefem&#39;</span><span class="p">]</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_strain_sparU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_spar&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma_strain</span> <span class="o">/</span> <span class="n">strain_ult_spar</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_strain_sparL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_spar&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma_strain</span> <span class="o">/</span> <span class="n">strain_ult_spar</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_strain_teU&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_te&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma_strain</span> <span class="o">/</span> <span class="n">strain_ult_te</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_strain_teL&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_te&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma_strain</span> <span class="o">/</span> <span class="n">strain_ult_te</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_sparU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_spar&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma_f</span> <span class="o">/</span> <span class="n">eps_crit_spar</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_sparL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_spar&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma_f</span> <span class="o">/</span> <span class="n">eps_crit_spar</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_teU&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_te&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma_f</span> <span class="o">/</span> <span class="n">eps_crit_te</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_teL&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_te&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma_f</span> <span class="o">/</span> <span class="n">eps_crit_te</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_damage_sparU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;damageU_spar&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_damage_sparL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;damageL_spar&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_damage_teU&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;damageU_te&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_damage_teL&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;damageL_te&#39;</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">omega</span>           <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">60.0</span> <span class="c1">#Hz</span>
        <span class="n">gamma_freq</span>      <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_freq&#39;</span><span class="p">]</span>
        <span class="n">gamma_f</span>         <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span>
        <span class="n">gamma_m</span>         <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_m&#39;</span><span class="p">]</span>
        <span class="n">gamma_strain</span>    <span class="o">=</span> <span class="n">gamma_f</span> <span class="o">*</span> <span class="n">gamma_m</span>
        <span class="n">strain_ult_spar</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strain_ult_spar&#39;</span><span class="p">]</span>
        <span class="n">strain_ult_te</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strain_ult_te&#39;</span><span class="p">]</span>
        <span class="n">eps_crit_spar</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;eps_crit_spar&#39;</span><span class="p">]</span>
        <span class="n">eps_crit_te</span>     <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;eps_crit_te&#39;</span><span class="p">]</span>

        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">myones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">NPTS</span><span class="p">,))</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pn_margin&#39;</span><span class="p">,</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nBlades&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">gamma_freq</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pn_margin&#39;</span><span class="p">,</span><span class="s1">&#39;gamma_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nBlades&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pn_margin&#39;</span><span class="p">,</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Pn_margin&#39;</span><span class="p">])</span>  <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;P1_margin&#39;</span><span class="p">,</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">gamma_freq</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;P1_margin&#39;</span><span class="p">,</span><span class="s1">&#39;gamma_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;P1_margin&#39;</span><span class="p">,</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;P1_margin&#39;</span><span class="p">])</span>  <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pn_margin_cfem&#39;</span><span class="p">,</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nBlades&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">gamma_freq</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq_curvefem&#39;</span><span class="p">]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pn_margin_cfem&#39;</span><span class="p">,</span><span class="s1">&#39;gamma_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nBlades&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq_curvefem&#39;</span><span class="p">]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pn_margin_cfem&#39;</span><span class="p">,</span><span class="s1">&#39;freq_cfem&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Pn_margin_cfem&#39;</span><span class="p">])</span>  <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq_curvefem&#39;</span><span class="p">]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;P1_margin_cfem&#39;</span><span class="p">,</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">gamma_freq</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq_curvefem&#39;</span><span class="p">]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;P1_margin_cfem&#39;</span><span class="p">,</span><span class="s1">&#39;gamma_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq_curvefem&#39;</span><span class="p">]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;P1_margin_cfem&#39;</span><span class="p">,</span><span class="s1">&#39;freq_cfem&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;P1_margin_cfem&#39;</span><span class="p">])</span>  <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq_curvefem&#39;</span><span class="p">]</span>
        
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_sparU&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_spar&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma_m</span> <span class="o">/</span> <span class="n">strain_ult_spar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_sparL&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_spar&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma_m</span> <span class="o">/</span> <span class="n">strain_ult_spar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_teU&#39;</span>  <span class="p">,</span> <span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_te&#39;</span><span class="p">]</span>   <span class="o">*</span> <span class="n">gamma_m</span> <span class="o">/</span> <span class="n">strain_ult_te</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_teL&#39;</span>  <span class="p">,</span> <span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_te&#39;</span><span class="p">]</span>   <span class="o">*</span> <span class="n">gamma_m</span> <span class="o">/</span> <span class="n">strain_ult_te</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_sparU&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_spar&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma_f</span> <span class="o">/</span> <span class="n">strain_ult_spar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_sparL&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_spar&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma_f</span> <span class="o">/</span> <span class="n">strain_ult_spar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_teU&#39;</span>  <span class="p">,</span> <span class="s1">&#39;gamma_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_te&#39;</span><span class="p">]</span>   <span class="o">*</span> <span class="n">gamma_f</span> <span class="o">/</span> <span class="n">strain_ult_te</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_teL&#39;</span>  <span class="p">,</span> <span class="s1">&#39;gamma_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_te&#39;</span><span class="p">]</span>   <span class="o">*</span> <span class="n">gamma_f</span> <span class="o">/</span> <span class="n">strain_ult_te</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_sparU&#39;</span><span class="p">,</span> <span class="s1">&#39;strainU_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_strain</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">myones</span><span class="p">)</span> <span class="o">/</span> <span class="n">strain_ult_spar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_sparL&#39;</span><span class="p">,</span> <span class="s1">&#39;strainL_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_strain</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">myones</span><span class="p">)</span> <span class="o">/</span> <span class="n">strain_ult_spar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_teU&#39;</span>  <span class="p">,</span> <span class="s1">&#39;strainU_te&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">gamma_strain</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">myones</span><span class="p">)</span> <span class="o">/</span> <span class="n">strain_ult_te</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_teL&#39;</span>  <span class="p">,</span> <span class="s1">&#39;strainL_te&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">gamma_strain</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">myones</span><span class="p">)</span> <span class="o">/</span> <span class="n">strain_ult_te</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_sparU&#39;</span><span class="p">,</span> <span class="s1">&#39;strain_ult_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_strain_sparU&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">strain_ult_spar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_sparL&#39;</span><span class="p">,</span> <span class="s1">&#39;strain_ult_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_strain_sparL&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">strain_ult_spar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_teU&#39;</span>  <span class="p">,</span> <span class="s1">&#39;strain_ult_te&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="o">-</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_strain_teU&#39;</span><span class="p">]</span>   <span class="o">/</span> <span class="n">strain_ult_te</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_strain_teL&#39;</span>  <span class="p">,</span> <span class="s1">&#39;strain_ult_te&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="o">-</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_strain_teL&#39;</span><span class="p">]</span>   <span class="o">/</span> <span class="n">strain_ult_te</span>
        
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_sparU&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_spar&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">eps_crit_spar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_sparL&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_spar&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">eps_crit_spar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_teU&#39;</span>  <span class="p">,</span> <span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_te&#39;</span><span class="p">]</span>   <span class="o">/</span> <span class="n">eps_crit_te</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_teL&#39;</span>  <span class="p">,</span> <span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_te&#39;</span><span class="p">]</span>   <span class="o">/</span> <span class="n">eps_crit_te</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_sparU&#39;</span><span class="p">,</span> <span class="s1">&#39;strainU_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_f</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">myones</span><span class="p">)</span> <span class="o">/</span> <span class="n">eps_crit_spar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_sparL&#39;</span><span class="p">,</span> <span class="s1">&#39;strainL_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_f</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">myones</span><span class="p">)</span> <span class="o">/</span> <span class="n">eps_crit_spar</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_teU&#39;</span>  <span class="p">,</span> <span class="s1">&#39;strainU_te&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">gamma_f</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">myones</span><span class="p">)</span> <span class="o">/</span> <span class="n">eps_crit_te</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_teL&#39;</span>  <span class="p">,</span> <span class="s1">&#39;strainL_te&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">gamma_f</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">myones</span><span class="p">)</span> <span class="o">/</span> <span class="n">eps_crit_te</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_sparU&#39;</span><span class="p">,</span> <span class="s1">&#39;eps_crit_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_sparU&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">eps_crit_spar</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_sparL&#39;</span><span class="p">,</span> <span class="s1">&#39;eps_crit_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_sparL&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">eps_crit_spar</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_teU&#39;</span>  <span class="p">,</span> <span class="s1">&#39;eps_crit_te&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_teU&#39;</span><span class="p">]</span>   <span class="o">/</span> <span class="n">eps_crit_te</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_teL&#39;</span>  <span class="p">,</span> <span class="s1">&#39;eps_crit_te&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;rotor_buckling_teL&#39;</span><span class="p">]</span>   <span class="o">/</span> <span class="n">eps_crit_te</span><span class="p">)</span>
        
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_damage_sparU&#39;</span><span class="p">,</span> <span class="s1">&#39;damageU_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">myones</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_damage_sparL&#39;</span><span class="p">,</span> <span class="s1">&#39;damageL_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">myones</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_damage_teU&#39;</span><span class="p">,</span> <span class="s1">&#39;damageU_te&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">myones</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;rotor_damage_teL&#39;</span><span class="p">,</span> <span class="s1">&#39;damageL_te&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">myones</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">J</span></div>
    
<div class="viewcode-block" id="OutputsStructures"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.OutputsStructures">[docs]</a><span class="k">class</span> <span class="nc">OutputsStructures</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPTS</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OutputsStructures</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># structural outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;mass_one_blade_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass of one blade&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;mass_all_blades_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass of all blade&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;I_all_blades_in&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;out of plane moments of inertia in yaw-aligned c.s.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;freq_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;1st nF natural frequencies&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;freq_curvefem_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;1st nF natural frequencies&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tip_deflection_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;blade tip deflection in +x_y direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;strainU_spar_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;strainL_spar_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;strainU_te_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;strainL_te_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;eps_crit_spar_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;critical strain in spar from panel buckling calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;eps_crit_te_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span>  <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;critical strain in trailing-edge panels from panel buckling calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;root_bending_moment_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total magnitude of bending moment at root of blade&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;damageU_spar_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on upper surface in spar cap&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;damageL_spar_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on lower surface in spar cap&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;damageU_te_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on upper surface in trailing-edge panels&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;damageL_te_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on lower surface in trailing-edge panels&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;delta_bladeLength_out_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;adjustment to blade length to account for curvature from loading&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;delta_precurve_sub_out_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NINPUT</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;adjustment to precurve to account for curvature from loading&#39;</span><span class="p">)</span>
        <span class="c1"># additional drivetrain moments output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Fxyz_1_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s. (blade #1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Fxyz_2_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s. (blade #2)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Fxyz_3_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s. (blade #3)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Fxyz_4_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s. (blade #4)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Fxyz_5_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s. (blade #5)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Fxyz_6_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s. (blade #6)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Mxyz_1_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s. (blade #1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Mxyz_2_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s. (blade #2)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Mxyz_3_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s. (blade #3)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Mxyz_4_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s. (blade #4)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Mxyz_5_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s. (blade #5)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Mxyz_6_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s. (blade #6)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;TotalCone_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total cone angle for blades at rated&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Pitch_in&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;pitch angle at rated&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;nBlades&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Number of blades on rotor&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># structural outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;mass_one_blade&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass of one blade&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;mass_all_blades&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass of all blade&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;I_all_blades&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;out of plane moments of inertia in yaw-aligned c.s.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;1st nF natural frequencies&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;freq_curvefem&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;1st nF natural frequencies&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;blade tip deflection in +x_y direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;strainU_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;strainL_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;strainU_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;strainL_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;eps_crit_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;critical strain in spar from panel buckling calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;eps_crit_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span>  <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;critical strain in trailing-edge panels from panel buckling calculation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total magnitude of bending moment at root of blade&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;damageU_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on upper surface in spar cap&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;damageL_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on lower surface in spar cap&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;damageU_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on upper surface in trailing-edge panels&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;damageL_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue damage on lower surface in trailing-edge panels&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;delta_bladeLength_out&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;adjustment to blade length to account for curvature from loading&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;delta_precurve_sub_out&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NINPUT</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;adjustment to precurve to account for curvature from loading&#39;</span><span class="p">)</span>
        <span class="c1"># additional drivetrain moments output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Fxyz_1&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s. (blade #1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Fxyz_2&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s. (blade #2)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Fxyz_3&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s. (blade #3)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Fxyz_4&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s. (blade #4)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Fxyz_5&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s. (blade #5)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Fxyz_6&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual forces [x,y,z] at the blade root in blade c.s. (blade #6)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mxyz_1&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s. (blade #1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mxyz_2&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s. (blade #2)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mxyz_3&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s. (blade #3)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mxyz_4&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s. (blade #4)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mxyz_5&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s. (blade #5)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mxyz_6&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in blade c.s. (blade #6)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Fxyz_total&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Total force [x,y,z] at the blade root in *hub* c.s.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mxyz_total&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;individual moments [x,y,z] at the blade root in *hub* c.s.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;TotalCone&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total cone angle for blades at rated&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Pitch&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;pitch angle at rated&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;mass_one_blade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mass_one_blade_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;mass_all_blades&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mass_all_blades_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;I_all_blades&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;I_all_blades_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;freq_curvefem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq_curvefem_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tip_deflection_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;strainU_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_spar_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;strainL_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_spar_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;strainU_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_te_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;strainL_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_te_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;eps_crit_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;eps_crit_spar_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;eps_crit_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;eps_crit_te_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;root_bending_moment_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;damageU_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;damageU_spar_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;damageL_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;damageL_spar_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;damageU_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;damageU_te_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;damageL_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;damageL_te_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength_out_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub_out_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;TotalCone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;TotalCone_in&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Pitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Pitch_in&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">):</span>
            <span class="n">kstr</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Fxyz&#39;</span><span class="o">+</span><span class="n">kstr</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Fxyz&#39;</span><span class="o">+</span><span class="n">kstr</span><span class="o">+</span><span class="s1">&#39;_in&#39;</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Mxyz&#39;</span><span class="o">+</span><span class="n">kstr</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mxyz&#39;</span><span class="o">+</span><span class="n">kstr</span><span class="o">+</span><span class="s1">&#39;_in&#39;</span><span class="p">]</span> <span class="p">)</span>

        <span class="c1"># TODO: This is meant to sum up forces and torques across all blades while taking into account coordinate systems</span>
        <span class="c1"># This may not be necessary as CCBlade returns total thrust (T) and torque (Q), which are the only non-zero F &amp; M entries anyway</span>
        <span class="c1"># The difficulty is that the answers don&#39;t match exactly.</span>
        <span class="n">F_hub</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Fxyz_1_in&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Fxyz_2_in&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Fxyz_3_in&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Fxyz_4_in&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Fxyz_5_in&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Fxyz_6_in&#39;</span><span class="p">]])</span> <span class="p">)</span>
        <span class="n">M_hub</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mxyz_1_in&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mxyz_2_in&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mxyz_3_in&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mxyz_4_in&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mxyz_5_in&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mxyz_6_in&#39;</span><span class="p">]])</span> <span class="p">)</span>

        <span class="n">nBlades</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nBlades&#39;</span><span class="p">]</span>
        <span class="n">angles</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="n">nBlades</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Initialize summation</span>
        <span class="n">F_hub_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,))</span>
        <span class="n">M_hub_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,))</span>
        <span class="n">dFx_dF</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">F_hub</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">dFy_dF</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">F_hub</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">dFz_dF</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">F_hub</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">dMx_dM</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M_hub</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">dMy_dM</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M_hub</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">dMz_dM</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M_hub</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="c1"># Convert from blade to hub c.s.</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">nBlades</span><span class="p">):</span>
            <span class="n">myF</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="o">.</span><span class="n">fromArray</span><span class="p">(</span><span class="n">F_hub</span><span class="p">[</span><span class="n">row</span><span class="p">,:])</span><span class="o">.</span><span class="n">azimuthToHub</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
            <span class="n">myM</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="o">.</span><span class="n">fromArray</span><span class="p">(</span><span class="n">M_hub</span><span class="p">[</span><span class="n">row</span><span class="p">,:])</span><span class="o">.</span><span class="n">azimuthToHub</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
            
            <span class="n">F_hub_tot</span> <span class="o">+=</span> <span class="n">myF</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span>
            <span class="n">M_hub_tot</span> <span class="o">+=</span> <span class="n">myM</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span>

            <span class="n">dFx_dF</span><span class="p">[</span><span class="n">row</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">myF</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="n">myF</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="n">myF</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]])</span>
            <span class="n">dFy_dF</span><span class="p">[</span><span class="n">row</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">myF</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="n">myF</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="n">myF</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]])</span>
            <span class="n">dFz_dF</span><span class="p">[</span><span class="n">row</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">myF</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="n">myF</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="n">myF</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]])</span>

            <span class="n">dMx_dM</span><span class="p">[</span><span class="n">row</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">myM</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="n">myM</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="n">myM</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]])</span>
            <span class="n">dMy_dM</span><span class="p">[</span><span class="n">row</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">myM</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="n">myM</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="n">myM</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]])</span>
            <span class="n">dMz_dM</span><span class="p">[</span><span class="n">row</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">myM</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="n">myM</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="n">myM</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]])</span>

        <span class="c1"># Now sum over all blades</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Fxyz_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F_hub_tot</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Mxyz_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">M_hub_tot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">kstr</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">[</span><span class="s1">&#39;Fxyz_total&#39;</span><span class="p">,</span><span class="s1">&#39;Fxyz&#39;</span><span class="o">+</span><span class="n">kstr</span><span class="o">+</span><span class="s1">&#39;_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">dFx_dF</span><span class="p">[</span><span class="n">k</span><span class="p">,:],</span> <span class="n">dFy_dF</span><span class="p">[</span><span class="n">k</span><span class="p">,:],</span> <span class="n">dFz_dF</span><span class="p">[</span><span class="n">k</span><span class="p">,:]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mxyz_total&#39;</span><span class="p">,</span><span class="s1">&#39;Mxyz&#39;</span><span class="o">+</span><span class="n">kstr</span><span class="o">+</span><span class="s1">&#39;_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">dMx_dM</span><span class="p">[</span><span class="n">k</span><span class="p">,:],</span> <span class="n">dMy_dM</span><span class="p">[</span><span class="n">k</span><span class="p">,:],</span> <span class="n">dMz_dM</span><span class="p">[</span><span class="n">k</span><span class="p">,:]])</span>

    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;mass_one_blade&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_one_blade_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;mass_all_blades&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_all_blades_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;I_all_blades&#39;</span><span class="p">,</span> <span class="s1">&#39;I_all_blades_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;I_all_blades_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="s1">&#39;freq_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;freq_curvefem&#39;</span><span class="p">,</span> <span class="s1">&#39;freq_curvefem_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;freq_curvefem_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">,</span> <span class="s1">&#39;tip_deflection_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;strainU_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;strainU_spar_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_spar_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;strainL_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;strainL_spar_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_spar_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;strainU_te&#39;</span><span class="p">,</span> <span class="s1">&#39;strainU_te_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainU_te_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;strainL_te&#39;</span><span class="p">,</span> <span class="s1">&#39;strainL_te_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;strainL_te_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;eps_crit_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;eps_crit_spar_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;eps_crit_spar_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;eps_crit_te&#39;</span><span class="p">,</span> <span class="s1">&#39;eps_crit_te_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;eps_crit_te_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;root_bending_moment_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;damageU_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;damageU_spar_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;damageU_spar_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;damageL_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;damageL_spar_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;damageL_spar_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;damageU_te&#39;</span><span class="p">,</span> <span class="s1">&#39;damageU_te_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;damageU_te_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;damageL_te&#39;</span><span class="p">,</span> <span class="s1">&#39;damageL_te_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;damageL_te_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_bladeLength_out&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_bladeLength_out_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub_out&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_precurve_sub_out_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;delta_precurve_sub_out_in&#39;</span><span class="p">])))</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">):</span>
            <span class="n">kstr</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Fxyz&#39;</span><span class="o">+</span><span class="n">kstr</span><span class="p">,</span> <span class="s1">&#39;Fxyz&#39;</span><span class="o">+</span><span class="n">kstr</span><span class="o">+</span><span class="s1">&#39;_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Fxyz&#39;</span><span class="o">+</span><span class="n">kstr</span><span class="o">+</span><span class="s1">&#39;_in&#39;</span><span class="p">])))</span>
            <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mxyz&#39;</span><span class="o">+</span><span class="n">kstr</span><span class="p">,</span> <span class="s1">&#39;Mxyz&#39;</span><span class="o">+</span><span class="n">kstr</span><span class="o">+</span><span class="s1">&#39;_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mxyz&#39;</span><span class="o">+</span><span class="n">kstr</span><span class="o">+</span><span class="s1">&#39;_in&#39;</span><span class="p">])))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;TotalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;TotalCone_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;Pitch_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">J</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">J</span></div>



<div class="viewcode-block" id="RotorStructure"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.RotorStructure">[docs]</a><span class="k">class</span> <span class="nc">RotorStructure</span><span class="p">(</span><span class="n">Group</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RefBlade</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RotorStructure</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;rotor model&quot;&quot;&quot;</span>
        <span class="n">NPTS</span> <span class="o">=</span> <span class="n">RefBlade</span><span class="o">.</span><span class="n">npts</span>

        <span class="c1">#self.add(&#39;rho&#39;, IndepVarComp(&#39;rho&#39;, val=1.225), promotes=[&#39;*&#39;])</span>
        <span class="c1">#self.add(&#39;mu&#39;, IndepVarComp(&#39;mu&#39;, val=1.81e-5), promotes=[&#39;*&#39;])</span>
        <span class="c1">#self.add(&#39;shearExp&#39;, IndepVarComp(&#39;shearExp&#39;, val=0.2), promotes=[&#39;*&#39;])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;VfactorPC&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;VfactorPC&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fraction of rated speed at which the deflection is assumed to representative throughout the power curve calculation&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;turbulence_class&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;turbulence_class&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">TURBULENCE_CLASS</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;IEC turbulence class class&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;gust_stddev&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;gust_stddev&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>

        <span class="c1"># --- computation options ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tiploss&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;tiploss&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;hubloss&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;hubloss&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;wakerotation&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;wakerotation&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;usecd&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;usecd&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;nSector&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;nSector&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;number of sectors to divide rotor face into in computing thrust and power&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        
        <span class="c1"># --- control ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;c_tsr&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;control_tsr&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;tip-speed ratio in Region 2 (should be optimized externally)&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;c_pitch&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;control_pitch&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;pitch angle in region 2 (and region 3 for fixed pitch machines)&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;pitch_extreme&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;pitch_extreme&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;worst-case pitch at survival wind condition&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;azimuth_extreme&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;azimuth_extreme&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;worst-case azimuth at survival wind condition&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        
        <span class="c1"># --- composite sections ---</span>
        <span class="c1">#self.add(&#39;sparT&#39;, IndepVarComp(&#39;sparT&#39;, val=np.zeros(5), units=&#39;m&#39;, desc=&#39;spar cap thickness parameters&#39;), promotes=[&#39;*&#39;])</span>
        <span class="c1">#self.add(&#39;teT&#39;, IndepVarComp(&#39;teT&#39;, val=np.zeros(5), units=&#39;m&#39;, desc=&#39;trailing-edge thickness parameters&#39;), promotes=[&#39;*&#39;])</span>

        <span class="c1"># --- fatigue ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;rstar_damage&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;rstar_damage&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;nondimensional radial locations of damage equivalent moments&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Mxb_damage&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;Mxb_damage&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;damage equivalent moments about blade c.s. x-direction&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Myb_damage&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;Myb_damage&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NPTS</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;damage equivalent moments about blade c.s. y-direction&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;strain_ult_spar&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;strain_ult_spar&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;ultimate strain in spar cap&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;strain_ult_te&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;strain_ult_te&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">2500</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;uptimate strain in trailing-edge panels&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;m_damage&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;m_damage&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;slope of S-N curve for fatigue analysis&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;lifetime&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;lifetime&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;project lifetime for fatigue analysis&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;gamma_fatigue&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;gamma_fatigue&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1.755</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor for fatigue&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;gamma_freq&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;gamma_freq&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor for resonant frequencies&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1.35</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor for loads/stresses&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;gamma_m&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;gamma_m&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor for materials&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>


        <span class="c1"># --- options ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;dynamic_amplication_tip_deflection&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;dynamic_amplication_tip_deflection&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;a dynamic amplification factor to adjust the static deflection calculation&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>

        <span class="c1"># Geometry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;rotorGeometry&#39;</span><span class="p">,</span> <span class="n">RotorGeometry</span><span class="p">(</span><span class="n">RefBlade</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>

        <span class="c1"># --- add structures ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;curvature&#39;</span><span class="p">,</span> <span class="n">BladeCurvature</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="n">ResizeCompositeSection</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;gust&#39;</span><span class="p">,</span> <span class="n">GustETM</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;setuppc&#39;</span><span class="p">,</span>  <span class="n">SetupPCModVarSpeed</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;beam&#39;</span><span class="p">,</span> <span class="n">PreCompSections</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;aero_rated&#39;</span><span class="p">,</span> <span class="n">CCBladeLoads</span><span class="p">(</span><span class="n">NPTS</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;aero_extrm&#39;</span><span class="p">,</span> <span class="n">CCBladeLoads</span><span class="p">(</span><span class="n">NPTS</span><span class="p">,</span>  <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;aero_extrm_forces&#39;</span><span class="p">,</span> <span class="n">CCBladePower</span><span class="p">(</span><span class="n">NPTS</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;aero_defl_powercurve&#39;</span><span class="p">,</span> <span class="n">CCBladeLoads</span><span class="p">(</span><span class="n">NPTS</span><span class="p">,</span>  <span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;loads_defl&#39;</span><span class="p">,</span> <span class="n">TotalLoads</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;loads_pc_defl&#39;</span><span class="p">,</span> <span class="n">TotalLoads</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;loads_strain&#39;</span><span class="p">,</span> <span class="n">TotalLoads</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;damage&#39;</span><span class="p">,</span> <span class="n">DamageLoads</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;struc&#39;</span><span class="p">,</span> <span class="n">RotorWithpBEAM</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gamma_fatigue&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;curvefem&#39;</span><span class="p">,</span> <span class="n">CurveFEM</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tip&#39;</span><span class="p">,</span> <span class="n">TipDeflection</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;root_moment&#39;</span><span class="p">,</span> <span class="n">RootMoment</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;mass&#39;</span><span class="p">,</span> <span class="n">MassProperties</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;extreme&#39;</span><span class="p">,</span> <span class="n">ExtremeLoads</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;blade_defl&#39;</span><span class="p">,</span> <span class="n">BladeDeflection</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;aero_0&#39;</span><span class="p">,</span> <span class="n">CCBladeLoads</span><span class="p">(</span><span class="n">NPTS</span><span class="p">,</span>  <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;aero_120&#39;</span><span class="p">,</span> <span class="n">CCBladeLoads</span><span class="p">(</span><span class="n">NPTS</span><span class="p">,</span>  <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;aero_240&#39;</span><span class="p">,</span> <span class="n">CCBladeLoads</span><span class="p">(</span><span class="n">NPTS</span><span class="p">,</span>  <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;root_moment_0&#39;</span><span class="p">,</span> <span class="n">RootMoment</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;root_moment_120&#39;</span><span class="p">,</span> <span class="n">RootMoment</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;root_moment_240&#39;</span><span class="p">,</span> <span class="n">RootMoment</span><span class="p">(</span><span class="n">NPTS</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;output_struc&#39;</span><span class="p">,</span> <span class="n">OutputsStructures</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;constraints&#39;</span><span class="p">,</span> <span class="n">ConstraintsStructures</span><span class="p">(</span><span class="n">NPTS</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>

        <span class="c1"># connections to curvature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;r_pts&#39;</span><span class="p">,</span> <span class="s1">&#39;curvature.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve&#39;</span><span class="p">,</span> <span class="s1">&#39;curvature.precurve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;presweep&#39;</span><span class="p">,</span> <span class="s1">&#39;curvature.presweep&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precone&#39;</span><span class="p">,</span> <span class="s1">&#39;curvature.precone&#39;</span><span class="p">)</span>

        <span class="c1"># connections to resize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="s1">&#39;resize.chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;sparT&#39;</span><span class="p">,</span> <span class="s1">&#39;resize.sparT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;teT&#39;</span><span class="p">,</span> <span class="s1">&#39;resize.teT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;upperCS&#39;</span><span class="p">,</span> <span class="s1">&#39;resize.upperCS_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;lowerCS&#39;</span><span class="p">,</span> <span class="s1">&#39;resize.lowerCS_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;websCS&#39;</span><span class="p">,</span> <span class="s1">&#39;resize.websCS_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;chord_ref&#39;</span><span class="p">,</span> <span class="s1">&#39;resize.chord_ref&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;sector_idx_strain_spar&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;resize.sector_idx_strain_spar&#39;</span><span class="p">,</span><span class="s1">&#39;beam.sector_idx_strain_spar&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;sector_idx_strain_te&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;resize.sector_idx_strain_te&#39;</span><span class="p">,</span><span class="s1">&#39;beam.sector_idx_strain_te&#39;</span><span class="p">])</span>

        <span class="c1"># connections to gust</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;turbulence_class&#39;</span><span class="p">,</span> <span class="s1">&#39;gust.turbulence_class&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;turbineclass.V_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;gust.V_mean&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;gust.V_hub&#39;</span><span class="p">,</span> <span class="s1">&#39;setuppc.Vrated&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;gust_stddev&#39;</span><span class="p">,</span> <span class="s1">&#39;gust.std&#39;</span><span class="p">)</span>
        
        <span class="c1"># connections to setuppc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;control_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;setuppc.control_pitch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;control_tsr&#39;</span><span class="p">,</span> <span class="s1">&#39;setuppc.control_tsr&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;geom.R&#39;</span><span class="p">,</span> <span class="s1">&#39;setuppc.R&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;VfactorPC&#39;</span><span class="p">,</span> <span class="s1">&#39;setuppc.Vfactor&#39;</span><span class="p">)</span>

        <span class="c1"># connections to aero_rated (for max deflection)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;r_pts&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.precurve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve_tip&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.precurveTip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Rhub&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.Rhub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Rtip&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.Rtip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;hub_height&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.hubHt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precone&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.precone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;yaw&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.yaw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;airfoils&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.airfoils&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;nSector&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.nSector&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;gust.V_gust&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_rated.V_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_rated</span><span class="o">.</span><span class="n">azimuth_load</span> <span class="o">=</span> <span class="mf">180.0</span>  <span class="c1"># closest to tower</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.Omega_load&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;curvefem.Omega&#39;</span><span class="p">,</span><span class="s1">&#39;aero_0.Omega_load&#39;</span><span class="p">,</span><span class="s1">&#39;aero_120.Omega_load&#39;</span><span class="p">,</span><span class="s1">&#39;aero_240.Omega_load&#39;</span><span class="p">])</span>
        
        <span class="c1"># connections to aero_extrm (for max strain)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;r_pts&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.precurve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve_tip&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.precurveTip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Rhub&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.Rhub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Rtip&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.Rtip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;hub_height&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.hubHt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precone&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.precone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;yaw&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.yaw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;airfoils&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.airfoils&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;nSector&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.nSector&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;turbineclass.V_extreme&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.V_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pitch_extreme&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.pitch_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;azimuth_extreme&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm.azimuth_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm</span><span class="o">.</span><span class="n">Omega_load</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># parked case</span>

        <span class="c1"># connections to aero_extrm_forces (for tower thrust)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;r_pts&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.precurve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve_tip&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.precurveTip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Rhub&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.Rhub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Rtip&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.Rtip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;hub_height&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.hubHt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precone&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.precone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;yaw&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.yaw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;airfoils&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.airfoils&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;nSector&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.nSector&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">Uhub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># parked case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;turbineclass.V_extreme_full&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_extrm_forces.Uhub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">])</span>  <span class="c1"># feathered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># connections to aero_defl_powercurve (for gust reversal)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;r_pts&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.precurve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve_tip&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.precurveTip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Rhub&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.Rhub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Rtip&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.Rtip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;hub_height&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.hubHt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precone&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.precone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;yaw&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.yaw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;airfoils&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.airfoils&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;nSector&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.nSector&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;setuppc.Uhub&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.V_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;setuppc.Omega&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.Omega_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;setuppc.pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.pitch_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;setuppc.azimuth&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_defl_powercurve.azimuth_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_defl_powercurve</span><span class="o">.</span><span class="n">azimuth_load</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># connections to beam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;r_pts&#39;</span><span class="p">,</span> <span class="s1">&#39;beam.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="s1">&#39;beam.chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;beam.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;resize.upperCS&#39;</span><span class="p">,</span> <span class="s1">&#39;beam.upperCS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;resize.lowerCS&#39;</span><span class="p">,</span> <span class="s1">&#39;beam.lowerCS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;resize.websCS&#39;</span><span class="p">,</span> <span class="s1">&#39;beam.websCS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;beam.profile&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;le_location&#39;</span><span class="p">,</span> <span class="s1">&#39;beam.le_location&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;materials&#39;</span><span class="p">,</span> <span class="s1">&#39;beam.materials&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_0.rho&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_120.rho&#39;</span><span class="p">,</span><span class="s1">&#39;aero_240.rho&#39;</span><span class="p">,</span><span class="s1">&#39;aero_defl_powercurve.rho&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm_forces.rho&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm.rho&#39;</span><span class="p">,</span><span class="s1">&#39;aero_rated.rho&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_0.mu&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_120.mu&#39;</span><span class="p">,</span><span class="s1">&#39;aero_240.mu&#39;</span><span class="p">,</span><span class="s1">&#39;aero_defl_powercurve.mu&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm_forces.mu&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm.mu&#39;</span><span class="p">,</span><span class="s1">&#39;aero_rated.mu&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_0.shearExp&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_120.shearExp&#39;</span><span class="p">,</span><span class="s1">&#39;aero_240.shearExp&#39;</span><span class="p">,</span><span class="s1">&#39;aero_defl_powercurve.shearExp&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm_forces.shearExp&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm.shearExp&#39;</span><span class="p">,</span><span class="s1">&#39;aero_rated.shearExp&#39;</span><span class="p">])</span>
        
        <span class="c1"># connections to loads_defl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_Omega&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.aeroloads_Omega&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_Px&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.aeroloads_Px&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_Py&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.aeroloads_Py&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.aeroloads_Pz&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_azimuth&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.aeroloads_azimuth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.aeroloads_pitch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_r&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.aeroloads_r&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:z&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.totalCone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.z_az&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.z_az&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:rhoA&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_defl.rhoA&#39;</span><span class="p">)</span>

        <span class="c1"># connections to loads_pc_defl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_defl_powercurve.loads_Omega&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.aeroloads_Omega&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_defl_powercurve.loads_Px&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.aeroloads_Px&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_defl_powercurve.loads_Py&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.aeroloads_Py&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_defl_powercurve.loads_Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.aeroloads_Pz&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_defl_powercurve.loads_azimuth&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.aeroloads_azimuth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_defl_powercurve.loads_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.aeroloads_pitch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_defl_powercurve.loads_r&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.aeroloads_r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:z&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.totalCone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.z_az&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.z_az&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:rhoA&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_pc_defl.rhoA&#39;</span><span class="p">)</span>

        <span class="c1"># connections to loads_strain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_extrm.loads_Omega&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.aeroloads_Omega&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_extrm.loads_Px&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.aeroloads_Px&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_extrm.loads_Py&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.aeroloads_Py&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_extrm.loads_Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.aeroloads_Pz&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_extrm.loads_azimuth&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.aeroloads_azimuth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_extrm.loads_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.aeroloads_pitch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_extrm.loads_r&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.aeroloads_r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:z&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.totalCone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.z_az&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.z_az&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:rhoA&#39;</span><span class="p">,</span> <span class="s1">&#39;loads_strain.rhoA&#39;</span><span class="p">)</span>

        <span class="c1"># connections to damage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;rstar_damage&#39;</span><span class="p">,</span> <span class="s1">&#39;damage.rstar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Mxb_damage&#39;</span><span class="p">,</span> <span class="s1">&#39;damage.Mxb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Myb_damage&#39;</span><span class="p">,</span> <span class="s1">&#39;damage.Myb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;damage.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:z&#39;</span><span class="p">,</span> <span class="s1">&#39;damage.r&#39;</span><span class="p">)</span>

        <span class="c1"># connections to struc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:z&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.beam:z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:EA&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.beam:EA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:EIxx&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.beam:EIxx&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:EIyy&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.beam:EIyy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:EIxy&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.beam:EIxy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:GJ&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.beam:GJ&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:rhoA&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.beam:rhoA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:rhoJ&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.beam:rhoJ&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:x_ec&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.beam:x_ec&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:y_ec&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.beam:y_ec&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;loads_defl.Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.Px_defl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;loads_defl.Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.Py_defl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;loads_defl.Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.Pz_defl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;loads_pc_defl.Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.Px_pc_defl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;loads_pc_defl.Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.Py_pc_defl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;loads_pc_defl.Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.Pz_pc_defl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;loads_strain.Px_af&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.Px_strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;loads_strain.Py_af&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.Py_strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;loads_strain.Pz_af&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.Pz_strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.xu_strain_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.xu_strain_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.xl_strain_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.xl_strain_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.yu_strain_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.yu_strain_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.yl_strain_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.yl_strain_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.xu_strain_te&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.xu_strain_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.xl_strain_te&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.xl_strain_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.yu_strain_te&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.yu_strain_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.yl_strain_te&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.yl_strain_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;damage.Mxa&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.Mx_damage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;damage.Mya&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.My_damage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;strain_ult_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.strain_ult_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;strain_ult_te&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.strain_ult_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;m_damage&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.m_damage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;lifetime&#39;</span><span class="p">,</span> <span class="s1">&#39;struc.lifetime&#39;</span><span class="p">)</span>

        <span class="c1"># connections to curvefem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:z&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.beam:z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:EA&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.beam:EA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:EIxx&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.beam:EIxx&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:EIyy&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.beam:EIyy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:EIxy&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.beam:EIxy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:GJ&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.beam:GJ&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:rhoA&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.beam:rhoA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:rhoJ&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.beam:rhoJ&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:x_ec&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.beam:x_ec&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.beam:y_ec&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.beam:y_ec&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.precurve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;presweep&#39;</span><span class="p">,</span> <span class="s1">&#39;curvefem.presweep&#39;</span><span class="p">)</span>

        <span class="c1"># connections to tip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.dx_defl&#39;</span><span class="p">,</span> <span class="s1">&#39;tip.dx&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">NPTS</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.dy_defl&#39;</span><span class="p">,</span> <span class="s1">&#39;tip.dy&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">NPTS</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.dz_defl&#39;</span><span class="p">,</span> <span class="s1">&#39;tip.dz&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">NPTS</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;tip.theta&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">NPTS</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;tip.pitch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_azimuth&#39;</span><span class="p">,</span> <span class="s1">&#39;tip.azimuth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;tip.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;tip.totalConeTip&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">NPTS</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;dynamic_amplication_tip_deflection&#39;</span><span class="p">,</span> <span class="s1">&#39;tip.dynamicFactor&#39;</span><span class="p">)</span>


        <span class="c1"># connections to root moment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;r_pts&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment.r_pts&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_Px&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment.aeroloads_Px&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_Py&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment.aeroloads_Py&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment.aeroloads_Pz&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_r&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment.aeroloads_r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment.totalCone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.x_az&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment.x_az&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.y_az&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment.y_az&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.z_az&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment.z_az&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.s&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment.s&#39;</span><span class="p">)</span>


        <span class="c1"># connections to mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.blade_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;mass.blade_mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.blade_moment_of_inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;mass.blade_moment_of_inertia&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s1">&#39;mass.nBlades&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;mass.tilt&#39;</span><span class="p">)</span>

        <span class="c1"># connectsion to extreme</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_extrm_forces.T&#39;</span><span class="p">,</span> <span class="s1">&#39;extreme.T&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_extrm_forces.Q&#39;</span><span class="p">,</span> <span class="s1">&#39;extreme.Q&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s1">&#39;extreme.nBlades&#39;</span><span class="p">)</span>

        <span class="c1"># connections to blade_defl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.dx_pc_defl&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_defl.dx&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.dy_pc_defl&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_defl.dy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.dz_pc_defl&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_defl.dz&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_defl_powercurve.loads_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_defl.pitch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_defl.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Rhub&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_defl.Rhub0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;r_pts&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_defl.r_pts0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_defl.precurve0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_defl.bladeLength0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;r_in&#39;</span><span class="p">,</span> <span class="s1">&#39;blade_defl.r_in0&#39;</span><span class="p">)</span>

        <span class="c1"># connect to outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.blade_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_one_blade_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;mass.mass_all_blades&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_all_blades_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;mass.I_all_blades&#39;</span><span class="p">,</span> <span class="s1">&#39;I_all_blades_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.freq&#39;</span><span class="p">,</span> <span class="s1">&#39;freq_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvefem.freq&#39;</span><span class="p">,</span> <span class="s1">&#39;freq_curvefem_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tip.tip_deflection&#39;</span><span class="p">,</span> <span class="s1">&#39;tip_deflection_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.strainU_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;strainU_spar_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.strainL_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;strainL_spar_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.strainU_te&#39;</span><span class="p">,</span> <span class="s1">&#39;strainU_te_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.strainL_te&#39;</span><span class="p">,</span> <span class="s1">&#39;strainL_te_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;root_moment.root_bending_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;root_bending_moment_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.eps_crit_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;eps_crit_spar_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;beam.eps_crit_te&#39;</span><span class="p">,</span> <span class="s1">&#39;eps_crit_te_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.damageU_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;damageU_spar_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.damageL_spar&#39;</span><span class="p">,</span> <span class="s1">&#39;damageL_spar_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.damageU_te&#39;</span><span class="p">,</span> <span class="s1">&#39;damageU_te_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;struc.damageL_te&#39;</span><span class="p">,</span> <span class="s1">&#39;damageL_te_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;blade_defl.delta_bladeLength&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_bladeLength_out_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;blade_defl.delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_precurve_sub_out_in&#39;</span><span class="p">)</span>


        <span class="c1">### adding for the drivetrain root moment calculations:</span>
        <span class="c1"># TODO - number and value of azimuth angles should be arbitrary user inputs</span>
        <span class="c1"># connections to aero_0 (for rated loads at 0 azimuth angle)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;r_pts&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.r&#39;</span><span class="p">,</span><span class="s1">&#39;aero_120.r&#39;</span><span class="p">,</span><span class="s1">&#39;aero_240.r&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.chord&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_120.chord&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.chord&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.theta&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_120.theta&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.theta&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.precurve&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_120.precurve&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.precurve&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precurve_tip&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.precurveTip&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_120.precurveTip&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.precurveTip&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Rhub&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.Rhub&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_120.Rhub&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.Rhub&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Rtip&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.Rtip&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_120.Rtip&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.Rtip&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;hub_height&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.hubHt&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_120.hubHt&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.hubHt&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;precone&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.precone&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_120.precone&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.precone&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_120.tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.tilt&#39;</span><span class="p">])</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;airfoils&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.airfoils&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_120.airfoils&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.airfoils&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;yaw&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.yaw&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_120.yaw&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.yaw&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;nBlades&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.B&#39;</span><span class="p">,</span><span class="s1">&#39;aero_120.B&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.B&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;nSector&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.nSector&#39;</span><span class="p">,</span><span class="s1">&#39;aero_120.nSector&#39;</span><span class="p">,</span><span class="s1">&#39;aero_240.nSector&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;gust.V_gust&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.V_load&#39;</span><span class="p">,</span><span class="s1">&#39;aero_120.V_load&#39;</span><span class="p">,</span><span class="s1">&#39;aero_240.V_load&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;pitch_load89&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;pitch_load89&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">89.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;azimuth_load0&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;azimuth_load0&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;azimuth_load120&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;azimuth_load120&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">120.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;azimuth_load240&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;azimuth_load240&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">240.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pitch_load89&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.pitch_load&#39;</span><span class="p">,</span><span class="s1">&#39;aero_120.pitch_load&#39;</span><span class="p">,</span><span class="s1">&#39;aero_240.pitch_load&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;azimuth_load0&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_0.azimuth_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;azimuth_load120&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_120.azimuth_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;azimuth_load240&#39;</span><span class="p">,</span> <span class="s1">&#39;aero_240.azimuth_load&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tiploss&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.tiploss&#39;</span><span class="p">,</span><span class="s1">&#39;aero_120.tiploss&#39;</span><span class="p">,</span><span class="s1">&#39;aero_240.tiploss&#39;</span><span class="p">,</span><span class="s1">&#39;aero_defl_powercurve.tiploss&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm_forces.tiploss&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm.tiploss&#39;</span><span class="p">,</span><span class="s1">&#39;aero_rated.tiploss&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;hubloss&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.hubloss&#39;</span><span class="p">,</span><span class="s1">&#39;aero_120.hubloss&#39;</span><span class="p">,</span><span class="s1">&#39;aero_240.hubloss&#39;</span><span class="p">,</span><span class="s1">&#39;aero_defl_powercurve.hubloss&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm_forces.hubloss&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm.hubloss&#39;</span><span class="p">,</span><span class="s1">&#39;aero_rated.hubloss&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;wakerotation&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.wakerotation&#39;</span><span class="p">,</span><span class="s1">&#39;aero_120.wakerotation&#39;</span><span class="p">,</span><span class="s1">&#39;aero_240.wakerotation&#39;</span><span class="p">,</span><span class="s1">&#39;aero_defl_powercurve.wakerotation&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm_forces.wakerotation&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm.wakerotation&#39;</span><span class="p">,</span><span class="s1">&#39;aero_rated.wakerotation&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;usecd&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aero_0.usecd&#39;</span><span class="p">,</span><span class="s1">&#39;aero_120.usecd&#39;</span><span class="p">,</span><span class="s1">&#39;aero_240.usecd&#39;</span><span class="p">,</span><span class="s1">&#39;aero_defl_powercurve.usecd&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm_forces.usecd&#39;</span><span class="p">,</span><span class="s1">&#39;aero_extrm.usecd&#39;</span><span class="p">,</span><span class="s1">&#39;aero_rated.usecd&#39;</span><span class="p">])</span>
        
        <span class="c1"># connections to root moment for drivetrain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;r_pts&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;root_moment_0.r_pts&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment_120.r_pts&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment_240.r_pts&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_Px&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;root_moment_0.aeroloads_Px&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment_120.aeroloads_Px&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment_240.aeroloads_Px&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_Py&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;root_moment_0.aeroloads_Py&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment_120.aeroloads_Py&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment_240.aeroloads_Py&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_Pz&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;root_moment_0.aeroloads_Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment_120.aeroloads_Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment_240.aeroloads_Pz&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.loads_r&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;root_moment_0.aeroloads_r&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment_120.aeroloads_r&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment_240.aeroloads_r&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.totalCone&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;root_moment_0.totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment_120.totalCone&#39;</span><span class="p">,</span> <span class="s1">&#39;root_moment_240.totalCone&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.x_az&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;root_moment_0.x_az&#39;</span><span class="p">,</span><span class="s1">&#39;root_moment_120.x_az&#39;</span><span class="p">,</span><span class="s1">&#39;root_moment_240.x_az&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.y_az&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;root_moment_0.y_az&#39;</span><span class="p">,</span><span class="s1">&#39;root_moment_120.y_az&#39;</span><span class="p">,</span><span class="s1">&#39;root_moment_240.y_az&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.z_az&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;root_moment_0.z_az&#39;</span><span class="p">,</span><span class="s1">&#39;root_moment_120.z_az&#39;</span><span class="p">,</span><span class="s1">&#39;root_moment_240.z_az&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.s&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;root_moment_0.s&#39;</span><span class="p">,</span><span class="s1">&#39;root_moment_120.s&#39;</span><span class="p">,</span><span class="s1">&#39;root_moment_240.s&#39;</span><span class="p">])</span>

        <span class="c1"># connections to root Mxyz outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;root_moment_0.Mxyz&#39;</span><span class="p">,</span><span class="s1">&#39;Mxyz_1_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;root_moment_120.Mxyz&#39;</span><span class="p">,</span><span class="s1">&#39;Mxyz_2_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;root_moment_240.Mxyz&#39;</span><span class="p">,</span><span class="s1">&#39;Mxyz_3_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;curvature.totalCone&#39;</span><span class="p">,</span><span class="s1">&#39;TotalCone_in&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">NPTS</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_0.pitch_load&#39;</span><span class="p">,</span><span class="s1">&#39;Pitch_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;root_moment_0.Fxyz&#39;</span><span class="p">,</span> <span class="s1">&#39;Fxyz_1_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;root_moment_120.Fxyz&#39;</span><span class="p">,</span> <span class="s1">&#39;Fxyz_2_in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;root_moment_240.Fxyz&#39;</span><span class="p">,</span> <span class="s1">&#39;Fxyz_3_in&#39;</span><span class="p">)</span>
        <span class="c1">#azimuths not passed. assumed 0,120,240 in drivese function</span>

        <span class="c1"># Connections to constraints not accounted for by promotes=*</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero_rated.Omega_load&#39;</span><span class="p">,</span> <span class="s1">&#39;Omega&#39;</span><span class="p">)</span></div>
        
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">myref</span> <span class="o">=</span> <span class="n">NREL5MW</span><span class="p">()</span>
    <span class="c1"># myref = DTU10MW()</span>

    <span class="n">rotor</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">()</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">RotorStructure</span><span class="p">(</span><span class="n">myref</span><span class="p">)</span>
    
    <span class="c1">#rotor.setup(check=False)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

    <span class="c1"># === blade grid ===</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;hubFraction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">hubFraction</span> <span class="c1">#0.025  # (Float): hub location as fraction of radius</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;bladeLength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">bladeLength</span> <span class="c1">#61.5  # (Float, m): blade length (if not precurved or swept) otherwise length of blade before curvature</span>
    <span class="c1"># rotor[&#39;delta_bladeLength&#39;] = 0.0  # (Float, m): adjustment to blade length to account for curvature from loading</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;precone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">precone</span> <span class="c1">#2.5  # (Float, deg): precone angle</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">tilt</span> <span class="c1">#5.0  # (Float, deg): shaft tilt</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;yaw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># (Float, deg): yaw error</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;nBlades&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">nBlades</span> <span class="c1">#3  # (Int): number of blades</span>
    <span class="c1"># ------------------</span>
    
    <span class="c1"># === blade geometry ===</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;r_max_chord&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">myref</span><span class="o">.</span><span class="n">r_max_chord</span>  <span class="c1"># 0.23577 #(Float): location of max chord on unit radius</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;chord_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">chord</span> <span class="c1"># np.array([3.2612, 4.3254, 4.5709, 3.7355, 2.69923333, 1.4621])  # (Array, m): chord at control points. defined at hub, then at linearly spaced locations from r_max_chord to tip</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;theta_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">theta</span> <span class="c1"># np.array([0.0, 13.2783, 12.30514836,  6.95106536,  2.72696309, -0.0878099]) # (Array, deg): twist at control points.  defined at linearly spaced locations from r[idx_cylinder] to tip</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;precurve_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">precurve</span> <span class="c1">#np.array([0.0, 0.0, 0.0])  # (Array, m): precurve at control points.  defined at same locations at chord, starting at 2nd control point (root must be zero precurve)</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;presweep_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">presweep</span> <span class="c1">#np.array([0.0, 0.0, 0.0])  # (Array, m): precurve at control points.  defined at same locations at chord, starting at 2nd control point (root must be zero precurve)</span>
    <span class="c1"># rotor[&#39;delta_precurve_in&#39;] = np.array([0.0, 0.0, 0.0])  # (Array, m): adjustment to precurve to account for curvature from loading</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;sparT_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">spar_thickness</span> <span class="c1"># np.array([0.0, 0.05, 0.047754, 0.045376, 0.031085, 0.0061398])  # (Array, m): spar cap thickness parameters</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;teT_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">te_thickness</span> <span class="c1"># np.array([0.0, 0.1, 0.09569, 0.06569, 0.02569, 0.00569])  # (Array, m): trailing-edge thickness parameters</span>
    <span class="c1"># ------------------</span>

    <span class="c1"># === atmosphere ===</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;aero_0.rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.225</span>  <span class="c1"># (Float, kg/m**3): density of air</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;aero_0.mu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.81206e-5</span>  <span class="c1"># (Float, kg/m/s): dynamic viscosity of air</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;aero_0.shearExp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span>  <span class="c1"># (Float): shear exponent</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;hub_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">90.0</span>  <span class="c1"># (Float, m): hub height</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;turbine_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">turbine_class</span> <span class="c1">#TURBINE_CLASS[&#39;I&#39;]  # (Enum): IEC turbine class</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;turbulence_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TURBULENCE_CLASS</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span>  <span class="c1"># (Enum): IEC turbulence class class</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;gust_stddev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="c1"># ----------------------</span>

    <span class="c1"># === control ===</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;control_tsr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">control_tsr</span> <span class="c1">#7.55  # (Float): tip-speed ratio in Region 2 (should be optimized externally)</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;control_pitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myref</span><span class="o">.</span><span class="n">control_pitch</span> <span class="c1">#0.0  # (Float, deg): pitch angle in region 2 (and region 3 for fixed pitch machines)</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;pitch_extreme&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># (Float, deg): worst-case pitch at survival wind condition</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;azimuth_extreme&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># (Float, deg): worst-case azimuth at survival wind condition</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;VfactorPC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.7</span>  <span class="c1"># (Float): fraction of rated speed at which the deflection is assumed to representative throughout the power curve calculation</span>
    <span class="c1"># ----------------------</span>

    <span class="c1"># === aero and structural analysis options ===</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;nSector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># (Int): number of sectors to divide rotor face into in computing thrust and power</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;dynamic_amplication_tip_deflection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.35</span>  <span class="c1"># (Float): a dynamic amplification factor to adjust the static deflection calculation</span>
    <span class="c1"># ----------------------</span>


    <span class="c1"># === fatigue ===</span>
    <span class="n">r_aero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.02222276</span><span class="p">,</span> <span class="mf">0.06666667</span><span class="p">,</span> <span class="mf">0.11111057</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.23333333</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.36666667</span><span class="p">,</span> <span class="mf">0.43333333</span><span class="p">,</span>
	               <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.56666667</span><span class="p">,</span> <span class="mf">0.63333333</span><span class="p">,</span> <span class="mf">0.64</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.83333333</span><span class="p">,</span> <span class="mf">0.88888943</span><span class="p">,</span> <span class="mf">0.93333333</span><span class="p">,</span>
	               <span class="mf">0.97777724</span><span class="p">])</span>  <span class="c1"># (Array): new aerodynamic grid on unit radius</span>
    <span class="n">rstar_damage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.000</span><span class="p">,</span> <span class="mf">0.022</span><span class="p">,</span> <span class="mf">0.067</span><span class="p">,</span> <span class="mf">0.111</span><span class="p">,</span> <span class="mf">0.167</span><span class="p">,</span> <span class="mf">0.233</span><span class="p">,</span> <span class="mf">0.300</span><span class="p">,</span> <span class="mf">0.367</span><span class="p">,</span> <span class="mf">0.433</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">,</span>
        <span class="mf">0.567</span><span class="p">,</span> <span class="mf">0.633</span><span class="p">,</span> <span class="mf">0.700</span><span class="p">,</span> <span class="mf">0.767</span><span class="p">,</span> <span class="mf">0.833</span><span class="p">,</span> <span class="mf">0.889</span><span class="p">,</span> <span class="mf">0.933</span><span class="p">,</span> <span class="mf">0.978</span><span class="p">])</span>  <span class="c1"># (Array): nondimensional radial locations of damage equivalent moments</span>
    <span class="n">Mxb_damage</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.3743E+003</span><span class="p">,</span> <span class="mf">2.0834E+003</span><span class="p">,</span> <span class="mf">1.8108E+003</span><span class="p">,</span> <span class="mf">1.5705E+003</span><span class="p">,</span> <span class="mf">1.3104E+003</span><span class="p">,</span>
        <span class="mf">1.0488E+003</span><span class="p">,</span> <span class="mf">8.2367E+002</span><span class="p">,</span> <span class="mf">6.3407E+002</span><span class="p">,</span> <span class="mf">4.7727E+002</span><span class="p">,</span> <span class="mf">3.4804E+002</span><span class="p">,</span> <span class="mf">2.4458E+002</span><span class="p">,</span> <span class="mf">1.6339E+002</span><span class="p">,</span>
        <span class="mf">1.0252E+002</span><span class="p">,</span> <span class="mf">5.7842E+001</span><span class="p">,</span> <span class="mf">2.7349E+001</span><span class="p">,</span> <span class="mf">1.1262E+001</span><span class="p">,</span> <span class="mf">3.8549E+000</span><span class="p">,</span> <span class="mf">4.4738E-001</span><span class="p">])</span>  <span class="c1"># (Array, N*m): damage equivalent moments about blade c.s. x-direction</span>
    <span class="n">Myb_damage</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.7732E+003</span><span class="p">,</span> <span class="mf">2.8155E+003</span><span class="p">,</span> <span class="mf">2.6004E+003</span><span class="p">,</span> <span class="mf">2.3933E+003</span><span class="p">,</span> <span class="mf">2.1371E+003</span><span class="p">,</span>
        <span class="mf">1.8459E+003</span><span class="p">,</span> <span class="mf">1.5582E+003</span><span class="p">,</span> <span class="mf">1.2896E+003</span><span class="p">,</span> <span class="mf">1.0427E+003</span><span class="p">,</span> <span class="mf">8.2015E+002</span><span class="p">,</span> <span class="mf">6.2449E+002</span><span class="p">,</span> <span class="mf">4.5229E+002</span><span class="p">,</span>
        <span class="mf">3.0658E+002</span><span class="p">,</span> <span class="mf">1.8746E+002</span><span class="p">,</span> <span class="mf">9.6475E+001</span><span class="p">,</span> <span class="mf">4.2677E+001</span><span class="p">,</span> <span class="mf">1.5409E+001</span><span class="p">,</span> <span class="mf">1.8426E+000</span><span class="p">])</span>  <span class="c1"># (Array, N*m): damage equivalent moments about blade c.s. y-direction</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">r_aero</span><span class="p">]</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">myref</span><span class="o">.</span><span class="n">r</span><span class="p">]</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;rstar_damage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">rstar_damage</span><span class="p">)</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;Mxb_damage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">Mxb_damage</span><span class="p">)</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;Myb_damage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">Myb_damage</span><span class="p">)</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;strain_ult_spar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0e-2</span>  <span class="c1"># (Float): ultimate strain in spar cap</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;strain_ult_te&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="o">*</span><span class="mf">1e-6</span> <span class="o">*</span> <span class="mi">2</span>   <span class="c1"># (Float): uptimate strain in trailing-edge panels, note that I am putting a factor of two for the damage part only.</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;gamma_fatigue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.755</span> <span class="c1"># (Float): safety factor for fatigue</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.35</span> <span class="c1"># (Float): safety factor for loads/stresses</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;gamma_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.1</span> <span class="c1"># (Float): safety factor for materials</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;gamma_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.1</span> <span class="c1"># (Float): safety factor for resonant frequencies</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;m_damage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># (Float): slope of S-N curve for fatigue analysis</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;lifetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">20.0</span>  <span class="c1"># (Float): number of cycles used in fatigue analysis  TODO: make function of rotation speed</span>
    <span class="c1"># ----------------</span>


    <span class="c1"># Adding in only in rotor_structure- otherwise would have been connected in larger assembly</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;gust.V_hub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">11.7386065326</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;aero_rated.Omega_load&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">12.0</span>
    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;aero_rated.pitch_load&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;control_pitch&#39;</span><span class="p">]</span>


    <span class="c1"># from myutilities import plt</span>

    <span class="c1"># === run and outputs ===</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    

    <span class="nb">print</span> <span class="s1">&#39;mass_one_blade =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;mass_one_blade&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;mass_all_blades =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;mass_all_blades&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;I_all_blades =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;I_all_blades&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;freq =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;tip_deflection =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;tip_deflection&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;root_bending_moment =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;root_bending_moment&#39;</span><span class="p">]</span>

    <span class="c1">#for io in rotor.root.unknowns:</span>
    <span class="c1">#    print(io + &#39; &#39; + str(rotor.root.unknowns[io]))</span>

    <span class="c1"># print rotor[&#39;aero_rated.loads_Px&#39;]</span>
    <span class="c1"># print rotor[&#39;aero_rated.loads_Py&#39;]</span>
    <span class="c1"># print rotor[&#39;aero_rated.loads_Pz&#39;]</span>
    <span class="c1"># print rotor[&#39;aero_rated.loads_r&#39;]</span>

    <span class="c1"># print rotor[&#39;aero_extrm.loads_Px&#39;]</span>
    <span class="c1"># print rotor[&#39;aero_extrm.loads_Py&#39;]</span>
    <span class="c1"># print rotor[&#39;aero_extrm.loads_Pz&#39;]</span>
    <span class="c1"># print rotor[&#39;aero_extrm.loads_r&#39;]</span>

    <span class="nb">print</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;r_pts&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;curvature.totalCone&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;curvature.z_az&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;curvature.s&#39;</span><span class="p">]</span>

    

    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;r_pts&#39;</span><span class="p">],</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;strainU_spar&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;suction&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;r_pts&#39;</span><span class="p">],</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;strainL_spar&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;pressure&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;r_pts&#39;</span><span class="p">],</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;eps_crit_spar&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;critical&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">5e-3</span><span class="p">,</span> <span class="mf">5e-3</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;strain&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="c1"># plt.save(&#39;/Users/sning/Desktop/strain_spar.pdf&#39;)</span>
    <span class="c1"># plt.save(&#39;/Users/sning/Desktop/strain_spar.png&#39;)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;r_pts&#39;</span><span class="p">],</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;strainU_te&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;suction&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;r_pts&#39;</span><span class="p">],</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;strainL_te&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;pressure&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;r_pts&#39;</span><span class="p">],</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;eps_crit_te&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;critical&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">5e-3</span><span class="p">,</span> <span class="mf">5e-3</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;strain&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="c1"># plt.save(&#39;/Users/sning/Desktop/strain_te.pdf&#39;)</span>
    <span class="c1"># plt.save(&#39;/Users/sning/Desktop/strain_te.png&#39;)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c1"># ----------------</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    f = open(&#39;deriv_structure.dat&#39;,&#39;w&#39;)</span>
<span class="sd">    out = rotor.check_partial_derivatives(f, compact_print=True)</span>
<span class="sd">    f.close()</span>
<span class="sd">    tol = 1e-4</span>
<span class="sd">    for comp in out.keys():</span>
<span class="sd">        for k in out[comp].keys():</span>
<span class="sd">            if ( (out[comp][k][&#39;rel error&#39;][0] &gt; tol) and (out[comp][k][&#39;abs error&#39;][0] &gt; tol) ):</span>
<span class="sd">                print k, out[comp][k][&#39;rel error&#39;][0], out[comp][k][&#39;abs error&#39;][0]</span>
<span class="sd">    &#39;&#39;&#39;</span>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">RotorSE 0.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, NREL.
      Last updated on Jul 05, 2018.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>